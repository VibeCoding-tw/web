<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>【學習 3】MTU 與分段傳輸：破除傳輸邊界 - Vibe Coding</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
</head>

<body class="bg-gray-50 flex flex-col min-h-screen text-gray-800 font-[Inter]">

    <!-- Hero Section -->
    <header
        class="relative bg-gradient-to-br from-slate-900 via-purple-900 to-indigo-900 text-white pt-24 pb-32 overflow-hidden">
        <div
            class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1544197150-b99a580bb7a8?q=80&w=2000&auto=format&fit=crop')] bg-cover bg-center opacity-10 mix-blend-overlay">
        </div>
        <div class="absolute inset-0 bg-gradient-to-t from-gray-50 to-transparent bottom-0 h-16"></div>

        <div class="container mx-auto px-4 relative z-10 text-center">
            <div class="mt-8 flex flex-wrap justify-center gap-4">
                <button
                    onclick="window.courseShared.enterMediaMode('video', 'https://www.youtube.com/embed/gb2uX7gimfE')"
                    class="flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-full font-bold shadow-lg transition transform hover:scale-105">
                    <span>📺</span> 觀看教學影片
                </button>
                <button
                    onclick="window.courseShared.enterMediaMode('doc', 'https://docs.google.com/document/d/e/2PACX-1vTcpsdcFOY6LFWe9F51ajvCuK6snTbaDXZKWbt8Z29OaN8tyzh0B3VONv_bfYKdO6EtlebvSWYK3Yfk/pub?embedded=true')"
                    class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-full font-bold shadow-lg transition transform hover:scale-105">
                    <span>📄</span> 閱讀課程講義
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 -mt-20 relative z-20 pb-20">

        <!-- Section 1: What is MTU -->
        <section class="mb-16">
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">
                <div class="p-1 bg-gradient-to-r from-blue-500 to-indigo-500"></div>
                <div class="p-8 md:p-12">
                    <div class="flex flex-col md:flex-row gap-12">
                        <div class="flex-1">
                            <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center gap-3">
                                <span class="text-4xl">📏</span> 1. 什麼是 MTU (Maximum Transmission Unit)？ (20 min)
                            </h2>
                            <div class="space-y-6 text-gray-600 text-lg leading-relaxed">
                                <p>
                                    <strong>核心定義：</strong>通訊鏈路中單個封包所能承載的最大位元組數。MTU 決定了你一次「對話」能講多少個字。
                                </p>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 my-8">
                                    <div class="bg-blue-50 p-6 rounded-2xl border border-blue-100">
                                        <h4 class="font-bold text-blue-800 mb-2">BLE 的物理限制</h4>
                                        <p class="text-sm">
                                            傳統 BLE 預設 MTU 通常只有 <strong>23 Bytes</strong>。扣除 3 Bytes 的 L2CAP
                                            標頭後，實際可用的數據載荷僅約 <strong>20 Bytes</strong>。
                                        </p>
                                    </div>
                                    <div class="bg-indigo-50 p-6 rounded-2xl border border-indigo-100">
                                        <h4 class="font-bold text-indigo-800 mb-2">生活比喻：電梯限重</h4>
                                        <p class="text-sm">
                                            MTU 就像一台電梯的載重限制。如果你有一台<strong>鋼琴</strong>（大的 JSON
                                            數據）要送上樓，你不能直接塞進去，必須先將其<strong>拆解成零件</strong>分別運送。
                                        </p>
                                    </div>
                                </div>

                                <div class="bg-amber-50 p-6 rounded-xl border border-amber-100 mt-8">
                                    <h4 class="font-bold text-amber-800 mb-2 flex items-center gap-2">
                                        <span>🤔</span> 常見問題
                                    </h4>
                                    <p class="text-amber-700 text-sm italic">
                                        「為什麼我發送一段 JSON 字串，ESP32 只收到前面的一小段？」—— 這通常就是因為長度超過了 MTU，導致後續數據被直接丟棄。
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: Necessity of Segmentation -->
        <section class="mb-16">
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">
                <div class="p-1 bg-gradient-to-r from-indigo-500 to-blue-500"></div>
                <div class="p-8 md:p-12">
                    <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center gap-3">
                        <span class="text-4xl">⚙️</span> 2. 分段傳輸與 MTU 交涉 (25 min)
                    </h2>
                    <div class="space-y-6 text-gray-600 text-lg leading-relaxed">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="space-y-4">
                                <h4 class="font-bold text-slate-800 flex items-center gap-2">
                                    <span class="text-blue-500">🤝</span> 1. MTU 交涉 (Negotiation)
                                </h4>
                                <p class="text-sm">
                                    在連線建立後，客戶端可以請求提升 MTU 限額（例如提升至 247 Bytes）。這就像是打電話給管委會，請求更換一台更大的貨梯。
                                </p>
                                <p class="text-sm text-slate-500">
                                    注意：這取決於手機硬體與 ESP32 藍牙棧的共同支援。
                                </p>
                            </div>
                            <div class="space-y-4">
                                <h4 class="font-bold text-slate-800 flex items-center gap-2">
                                    <span class="text-indigo-500">🧩</span> 2. 軟體分段 (Software Segmentation)
                                </h4>
                                <p class="text-sm">
                                    在程式碼層面將大字串切割成數個小塊（Chunks），逐一發送，並在接收端重新組裝。這是最保險的做法，不依賴硬體交涉。
                                </p>
                            </div>
                        </div>

                        <div class="bg-slate-800 text-blue-300 p-8 rounded-2xl font-mono mt-8">
                            <h4
                                class="text-white font-bold mb-4 border-b border-slate-700 pb-2 flex items-center gap-2">
                                <span>🎯</span> 學習任務：計算練習
                            </h4>
                            <p class="text-sm leading-relaxed">
                                測量一段標準的無人車狀態 JSON：<br>
                                <code class="text-yellow-400">{"x":102,"y":-45,"v":120,"b":85}</code> (長度約 35 Bytes)<br>
                                計算在 20 Bytes MTU 限制下，它需要被切成幾份才能成功傳輸？
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: Data Integrity -->
        <section class="mb-16">
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">
                <div class="p-1 bg-gradient-to-r from-slate-700 to-blue-900"></div>
                <div class="p-8 md:p-12">
                    <h2 class="text-3xl font-bold text-gray-900 mb-8 flex items-center gap-3">
                        <span class="text-4xl">🏁</span> 3. 數據完整性與終止符 (15 min)
                    </h2>
                    <div class="space-y-6 text-gray-600 text-lg">
                        <p>
                            <strong>標記結尾：</strong>接收方收到零散的零件時，該如何知道「鋼琴」已經送完了，可以開始組裝了？
                        </p>

                        <div class="bg-blue-900 text-blue-100 p-8 rounded-2xl shadow-inner mt-8">
                            <h4 class="text-white font-bold text-xl mb-4 flex items-center gap-2">
                                <span>🚀</span> 預習任務：終止符的重要性
                            </h4>
                            <p class="text-blue-200">
                                思考在字串末端加入特定符號（如 <code>\n</code> 或 <code>#</code>）作為「結尾符」的重要性。
                            </p>
                            <ul class="list-disc list-inside mt-4 text-sm text-blue-300 space-y-2">
                                <li>接收方持續將片段累加到 Buffer。</li>
                                <li>直到看見終止符，才觸發 <code>JSON.parse()</code>。</li>
                                <li>這樣能避免解析到「殘缺不全」的 JSON 導致程式崩潰。</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Assignment Highlights -->
        <section class="module-section">
            <div class="glass-card bg-slate-900 rounded-3xl shadow-2xl overflow-hidden border border-slate-800">
                <div class="p-8 md:p-12">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-12">
                        <div>
                            <h2 class="text-3xl font-bold text-white mb-2">數據傳輸實驗室：分段傳輸專家</h2>
                            <p class="text-slate-400">突破實體限制，建立穩健的大數據回傳機制。</p>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-8 mb-12">
                        <div class="bg-slate-800/50 p-8 rounded-2xl border border-slate-700">
                            <div class="flex items-center gap-4 mb-6">
                                <span class="text-2xl">📡</span>
                                <h3 class="text-white font-bold text-lg">基地台通訊協議 (Git Workflow)</h3>
                            </div>
                            <p class="mb-4 text-slate-400">在任務中，GitHub 是你的「基地台」。請確保每完成一個里程碑，就將數據回傳。</p>
                            <ul class="space-y-2 text-slate-300">
                                <li class="flex items-center gap-2">
                                    <span class="text-blue-500 font-bold">Step 1.</span>
                                    <span>接受 GitHub Classroom 邀請，複製 (Clone) 專屬任務倉庫。</span>
                                </li>
                                <li class="flex items-center gap-2">
                                    <span class="text-blue-500 font-bold">Step 2.</span>
                                    <span>完成代碼撰寫後，執行 <code
                                            class="bg-slate-800 px-2 py-0.5 rounded text-pink-400">git push</code>
                                        將進度上傳。</span>
                                </li>
                                <li class="flex items-center gap-2">
                                    <span class="text-blue-500 font-bold">Step 3.</span>
                                    <span>自動化助理會即時在 PR (Pull Request) 中回饋評分結果。</span>
                                </li>
                            </ul>
                        </div>

                        <div class="grid gap-4">
                            <!-- Task 3-1 -->
                            <div onclick="openSubmissionModal('adv-03-mtu-fragmenter', '【作業 3-1】「電梯拆解工」：手動分段發送器')"
                                class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 border border-gray-100 overflow-hidden group cursor-pointer relative flex flex-col p-6">
                                <div class="flex justify-between items-start mb-4">
                                    <h3 class="font-bold text-lg text-gray-800 group-hover:text-blue-600 transition">作業
                                        3-1</h3>
                                    <span class="bg-blue-100 text-blue-700 text-xs px-2 py-1 rounded font-bold">60
                                        min</span>
                                </div>
                                <h4 class="font-bold text-gray-700 mb-2">電梯拆解工</h4>
                                <p class="text-sm text-gray-500">實作數據手動分段邏輯，確保長字串能被順利傳輸。</p>
                            </div>

                            <!-- Task 3-2 -->
                            <div onclick="openSubmissionModal('adv-03-puzzle-reassembler', '【作業 3-2】「拼圖高手」：緩衝區重組器')"
                                class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 border border-gray-100 overflow-hidden group cursor-pointer relative flex flex-col p-6">
                                <div class="flex justify-between items-start mb-4">
                                    <h3 class="font-bold text-lg text-gray-800 group-hover:text-indigo-600 transition">
                                        作業 3-2</h3>
                                    <span class="bg-indigo-100 text-indigo-700 text-xs px-2 py-1 rounded font-bold">60
                                        min</span>
                                </div>
                                <h4 class="font-bold text-gray-700 mb-2">拼圖高手</h4>
                                <p class="text-sm text-gray-500">在接收端實作緩衝區重組與終止符偵測機制。</p>
                            </div>

                            <!-- Task 3-3 -->
                            <div onclick="openSubmissionModal('adv-03-mtu-performance', '【作業 3-3】MTU 請求與效能分析')"
                                class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 border border-gray-100 overflow-hidden group cursor-pointer relative flex flex-col p-6">
                                <div class="flex justify-between items-start mb-4">
                                    <h3 class="font-bold text-lg text-gray-800 group-hover:text-slate-600 transition">作業
                                        3-3</h3>
                                    <span class="bg-slate-100 text-slate-700 text-xs px-2 py-1 rounded font-bold">45
                                        min</span>
                                </div>
                                <h4 class="font-bold text-gray-700 mb-2">效能分析大賽</h4>
                                <p class="text-sm text-gray-500">比較提升 MTU 與手動分段的傳輸效率差異。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 py-12 border-t border-slate-800 mt-auto">
        <div class="container mx-auto px-4 text-center">
            <p class="text-slate-500 text-sm mb-4">&copy; 2026 Vibe Coding. All rights reserved.</p>
            <div class="flex flex-col md:flex-row justify-center items-center gap-6 text-sm text-slate-400">
                <span>進階課程 3 - 單元 3</span>
                <span class="hidden md:inline">|</span>
                <span>BLE MTU 與分段傳輸實務</span>
            </div>
        </div>
    </footer>

    <!-- Assignment Guide (Hidden) -->
    <section id="assignment-guide" style="display: none;">
        <h2>作業指引 (Assignment Guide)</h2>

        <h3>作業 3-1：電梯拆解工：手動分段發送器</h3>
        <ul>
            <li><strong>角色扮演：</strong> 通訊底層工程師。</li>
            <li><strong>執行方式：</strong> 撰寫 `fragmentData(text, size)` 函式，將長 JSON 字串依據邊界（如 20 Bytes）切分，並定時發送片段。</li>
            <li><strong>評分重點：</strong> 能否正確處理字串長度非倍數時的最後一個片段。</li>
        </ul>

        <h3>作業 3-2：拼圖高手：緩衝區重組器</h3>
        <ul>
            <li><strong>角色扮演：</strong> 前端系統整合員。</li>
            <li><strong>執行方式：</strong> 在接收端建立緩衝區 (`buffer`)，持續累加片段，並在偵測到結尾符（如 `\n`）時觸發解析。</li>
            <li><strong>評分重點：</strong> 代碼是否有防錯機制，防止在數據殘缺時解析 JSON 導致崩潰。</li>
        </ul>

        <h3>作業 3-3：效能分析大賽：MTU 請求實驗</h3>
        <ul>
            <li><strong>角色扮演：</strong> 效能優化專家。</li>
            <li><strong>執行方式：</strong> 嘗試提升 MTU 權限，對比「連續小包」與「單一長包」的耗時。</li>
            <li><strong>評分重點：</strong> 實驗報告是否能清楚闡述硬體限制對 MTU 提升的影響。</li>
        </ul>
    </section>

    <!-- Instructor Guide (Hidden) -->
    <section id="instructor-guide" style="display: none;">
        <!-- NEW: Practical Deployment Recommendations -->
        <div class="guide-section mb-10 p-6 bg-blue-50 border border-blue-100 rounded-xl shadow-inner">
            <h3 class="text-xl font-bold text-blue-900 border-b-2 border-blue-200 pb-3 mb-6 flex items-center gap-2">
                <span>🚀</span> 在 GitHub Classroom 的實戰部署建議
                <!-- Instructor Guide (Hidden) -->
                <section id="instructor-guide" style="display: none;">
                    <h2>GitHub Classroom 詳細操作指南</h2>
                    <div class="classroom-guide">
                        <p><strong>第一步：準備範本專案</strong></p>
                        <ol>
                            <li>提供能模擬 BLE MTU 限制的瀏覽器測試環境。</li>
                            <li>設定為 Template repository。</li>
                        </ol>

                        <p style="margin-top: 1rem;"><strong>第二步：建立 Classroom 作業</strong></p>
                        <ol>
                            <li>設定「大負載壓力測試」腳本，自動檢查字串完整性。</li>
                        </ol>

                        <p style="margin-top: 1rem;"><strong>第三步：學生端操作 (Flipped Workflow)</strong></p>
                        <ol>
                            <li>完成自研「終止符協議」實作。</li>
                            <li>提交 PR 紀錄 MTU 提升實驗數據。</li>
                        </ol>

                        <p style="margin-top: 1rem;"><strong>第四步：教師回饋 (Review)</strong></p>
                        <ol>
                            <li>針對 Buffer 溢位或傳輸超時的防護邏輯予以回饋。</li>
                        </ol>
                    </div>

                    <h2>在 GitHub Classroom 的實戰部署建議</h2>
                    <h3>A. 範本倉庫 (Template Repo) 結構</h3>
                    <pre><code>.
├── src/
│   ├── fragment_logic.js  # 實現手動分段 logic
│   └── reassembler.js     # 實現緩衝區重組
├── examples/
│   └── large_payload.json # 測試用的超大型 JSON
└── README.md             # 記錄：MTU 限制測試報告</code></pre>

                    <h3>B. 參考範例代碼 (Reference Example Code)</h3>
                    <p><strong>手動分段邏輯 (Conceptual)</strong></p>
                    <pre><code>for (let i = 0; i < data.length; i += size) send(data.substring(i, i + size));</code></pre>

                    <h3>C. 自動評估 (Autograding) 的設計</h3>
                    <ul>
                        <li><strong>片段完整性測試：</strong> 模擬傳送 500 Bytes 數據，檢查學生重組出的字串與原文是否一致。</li>
                        <li><strong>時序穩定性檢查：</strong> 檢查重組代碼是否能處理亂序的情況。</li>
                    </ul>

                    <h2>翻轉教室的實施策略</h2>
                    <table border="1" style="width:100%; border-collapse: collapse; margin-top: 1rem;">
                        <thead>
                            <tr style="background-color: #f8fafc;">
                                <th style="padding: 12px; border: 1px solid #e2e8f0; text-align: left;">階段</th>
                                <th style="padding: 12px; border: 1px solid #e2e8f0; text-align: left;">學生行動 (Git
                                    Workflow)</th>
                                <th style="padding: 12px; border: 1px solid #e2e8f0; text-align: left;">教師/平台角色</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 12px; border: 1px solid #e2e8f0;"><strong>課前 (預習)</strong></td>
                                <td style="padding: 12px; border: 1px solid #e2e8f0;">理解 BLE 物理層的 MTU 物理限制。</td>
                                <td style="padding: 12px; border: 1px solid #e2e8f0;">
                                    <strong>Dashboard：</strong>觀察「封包切片流程圖」。</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; border: 1px solid #e2e8f0;"><strong>課中 (實作)</strong></td>
                                <td style="padding: 12px; border: 1px solid #e2e8f0;">領取作業，實現穩定的大數據回傳系統。</td>
                                <td style="padding: 12px; border: 1px solid #e2e8f0;"><strong>實體協助：</strong>探討提升 MTU
                                    的穩定性考量。</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; border: 1px solid #e2e8f0;"><strong>課後 (精進)</strong></td>
                                <td style="padding: 12px; border: 1px solid #e2e8f0;">撰寫效能對比文檔並 Push。</td>
                                <td style="padding: 12px; border: 1px solid #e2e8f0;"><strong>PR Review：</strong>思考自定義協議
                                    (ACK 機制) 的價值。</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <script src="/js/course-shared.js"></script>
</body>

</html>