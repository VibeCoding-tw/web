<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>【學習 1】ESP32-S3 感測器介面與 PSRAM - Vibe Coding</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body class="bg-gray-50 flex flex-col min-h-screen text-gray-800 font-[Inter]">

    <!-- Hero Section -->
    <header
        class="relative bg-gradient-to-br from-slate-900 via-purple-900 to-indigo-900 text-white pt-24 pb-32 overflow-hidden">
        <div
            class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1624969862293-b749659ccc4e?q=80&w=2000&auto=format&fit=crop')] bg-cover bg-center opacity-10 mix-blend-overlay">
        </div>
        <div class="absolute inset-0 bg-gradient-to-t from-gray-50 to-transparent bottom-0 h-16"></div>

        <div class="container mx-auto px-4 relative z-10 text-center">
            <div
                class="badge-header inline-flex items-center gap-2 px-4 py-1 rounded-full bg-purple-500/20 text-purple-200 border border-purple-400/30 backdrop-blur-sm mb-6 text-xs font-semibold tracking-wide uppercase font-[Outfit]">
                進階 1 - 單元 1
            </div>
            <h1 class="text-4xl md:text-6xl font-extrabold mb-6 leading-tight tracking-tight font-[Outfit]">
                ESP32-S3<br>感測器介面與 PSRAM
            </h1>
            <p class="text-xl md:text-2xl text-purple-100 max-w-2xl mx-auto font-light leading-relaxed">
                釋放雙核心架構的 AI 潛能，掌握 PSRAM 記憶體魔術與 DMA 高速傳輸的奧秘。
            </p>

            <div class="mt-8 flex flex-wrap justify-center gap-4">
                <button onclick="enterMediaMode('video', window.RESOURCES.youtube)"
                    class="flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-full font-bold shadow-lg transition transform hover:scale-105">
                    <span>📺</span> 觀看教學影片
                </button>
                <button onclick="enterMediaMode('doc', window.RESOURCES.doc)"
                    class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-full font-bold shadow-lg transition transform hover:scale-105">
                    <span>📄</span> 閱讀課程講義
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 -mt-20 relative z-20 pb-20">

        <!-- Module 1: ESP32-S3 Architecture -->
        <section class="module-section mb-16">
            <div class="glass-card bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">
                <div class="p-1 bg-gradient-to-r from-fuchsia-500 to-purple-500"></div>
                <div class="p-8 md:p-12">
                    <div class="flex flex-col md:flex-row gap-12">
                        <div class="flex-1">
                            <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center gap-3">
                                <span class="text-4xl">🚀</span> 1. ESP32-S3：為 AI 與影像而生 (20 min)
                            </h2>
                            <div class="space-y-6 text-gray-600 text-lg">
                                <p><strong>硬體升級：</strong>了解 S3 的雙核心架構以及專為向量運算設計的指令集（加速卷積運算），這使其成為邊緣 AI 的理想選擇。</p>
                                <p><strong>感測器介面：</strong>認識常用於攝影機的 DVP (Digital Video Port) 介面 與用於顯示器的 LCD 介面。</p>

                                <div class="bg-purple-50 p-6 rounded-xl border border-purple-100 relative">
                                    <h4 class="font-bold text-purple-800 mb-2 flex items-center gap-2">
                                        <span>🔍</span> 學習任務
                                    </h4>
                                    <ul class="list-disc list-inside space-y-2 text-purple-700 text-base">
                                        <li>查閱 ESP32-S3 的腳位圖 (Pinout)。</li>
                                        <li>找出哪些腳位是與攝影機通訊固定的。</li>
                                        <li>找出哪些是可以彈性挪作他用的（如 I2C/SPI）。</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Module 2: PSRAM -->
        <section class="module-section mb-16">
            <div class="glass-card bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">
                <div class="p-1 bg-gradient-to-r from-blue-500 to-cyan-500"></div>
                <div class="p-8 md:p-12">
                    <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center gap-3">
                        <span class="text-4xl">🧠</span> 2. 記憶體魔術：什麼是 PSRAM？ (25 min)
                    </h2>
                    <div class="space-y-6 text-gray-600 text-lg">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2">內部 SRAM 的極限</h4>
                                <p class="text-sm leading-relaxed mb-4">
                                    ESP32 的內部記憶體只有幾百 KB，連一張未壓縮的 VGA 彩色圖片（$640 \times 480 \times 2 \text{ bytes} \approx
                                    600 \text{ KB}$）都裝不下。這限制了高解析度影像的處理能力。
                                </p>
                                <h4 class="font-bold text-gray-800 mb-2">PSRAM (Pseudo Static RAM)</h4>
                                <p class="text-sm leading-relaxed">
                                    透過外部串列介面 (SPI/QSPI/OPI) 擴充的數 MB 空間。就像是電腦的 RAM 條，讓 MCU 也能處理大數據。
                                </p>
                            </div>
                            <div class="bg-blue-50 p-6 rounded-xl border border-blue-100 flex flex-col justify-center">
                                <h4 class="font-bold text-blue-800 mb-3 flex items-center gap-2">
                                    <span>⚖️</span> 分配策略
                                </h4>
                                <ul class="space-y-3 text-blue-700 text-sm">
                                    <li class="flex items-start gap-2">
                                        <span
                                            class="bg-blue-200 text-blue-800 text-xs px-2 py-0.5 rounded mt-0.5">SRAM</span>
                                        <span>速度快、適合頻繁計算 (Stack, Global Variables)</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span
                                            class="bg-cyan-200 text-cyan-800 text-xs px-2 py-0.5 rounded mt-0.5">PSRAM</span>
                                        <span>空間大、適合存放影像框緩衝 (Frame Buffer)、AI 模型權重</span>
                                    </li>
                                </ul>
                                <div class="mt-4 pt-4 border-t border-blue-200">
                                    <h5 class="font-bold text-blue-800 mb-1">學習任務</h5>
                                    <p class="text-xs text-blue-600">比較「動態記憶體配置 (malloc)」與「PSRAM 專用配置 (ps_malloc)」的差異。
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Module 3: DMA -->
        <section class="module-section mb-16">
            <div class="glass-card bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">
                <div class="p-1 bg-gradient-to-r from-emerald-500 to-teal-600"></div>
                <div class="p-8 md:p-12">
                    <h2 class="text-3xl font-bold text-gray-900 mb-8 flex items-center gap-3">
                        <span class="text-4xl">⚡</span> 3. 高速傳輸的幕後推手：DMA (15 min)
                    </h2>
                    <div class="space-y-6 text-gray-600 text-lg">
                        <p><strong>DMA (Direct Memory Access)：</strong>讓感測器數據直接搬進記憶體，不需要 CPU 介入。這釋放了 CPU
                            去處理更重要的邏輯（如導航控制）。</p>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="bg-emerald-50 p-6 rounded-xl border border-emerald-100">
                                <h4 class="font-bold text-emerald-800 mb-3 flex items-center gap-2">
                                    <span>🔑</span> 關鍵概念
                                </h4>
                                <ul class="list-disc list-inside space-y-2 text-emerald-700 text-sm">
                                    <li>認識 <strong>DVP 介面</strong> 與 <strong>SCCB 協議</strong> (類似 I2C)。</li>
                                    <li>理解為何影像處理必須開啟 PSRAM。</li>
                                    <li>影像數據量計算：為什麼 640x480 的原始 RGB 數據會擠爆記憶體？</li>
                                </ul>
                            </div>
                            <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                                <h4 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                                    <span>🌐</span> 線上任務
                                </h4>
                                <p class="text-sm text-gray-600 mb-4">
                                    閱讀 ESP32-S3-CAM 引腳定義圖，找出負責影像傳輸的數據線與時鐘線。
                                </p>
                                <h5 class="font-bold text-gray-800 mb-2 text-sm">🧠 預習思考</h5>
                                <p class="text-sm text-gray-600 italic">
                                    若攝影機每秒產生 10MB 的數據，如果全部由 CPU 搬運，對我們的「無人車控制邏輯」會產生什麼影響？
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Assignments Section -->
        <section class="module-section">
            <h2 class="text-3xl font-bold text-center text-gray-800 mb-4 font-[Outfit]">核心實作：掌控 S3 的強大效能</h2>
            <p class="text-center text-gray-500 mb-12">透過實際程式碼，開啟用於邊緣運算的大門。</p>

            <div class="grid md:grid-cols-3 gap-6">
                <!-- Task 1-1 -->
                <div onclick="openSubmissionModal('adv-01-psram-test', '【作業 1-1】PSRAM 初始化與壓力測試')"
                    class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden flex flex-col group cursor-pointer relative hover:shadow-2xl transition-all hover:-translate-y-2">
                    <div class="bg-purple-500 h-2"></div>
                    <div class="p-8 flex-grow">
                        <div class="flex justify-between items-start mb-4">
                            <span class="text-4xl">💾</span>
                            <span class="bg-purple-100 text-purple-700 text-xs px-2 py-1 rounded font-bold uppercase">60
                                min</span>
                        </div>
                        <h3 class="font-bold text-xl text-gray-800 mb-2 group-hover:text-purple-600 transition">【作業 1-1】
                        </h3>
                        <h4 class="font-medium text-gray-500 mb-4">空間探索：PSRAM 初始化</h4>
                        <div class="text-sm text-gray-600 space-y-2">
                            <ul class="list-disc list-inside space-y-1">
                                <li><strong>啟用檢查：</strong>檢測 PSRAM 類型與總大小。</li>
                                <li><strong>分配實驗：</strong>對比 malloc() (失敗) vs heap_caps_malloc() (成功)。</li>
                                <li><strong>效能對比：</strong>測試內部 RAM 與 PSRAM 的百萬次讀寫耗時差異。</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Task 1-2 -->
                <div onclick="openSubmissionModal('adv-01-image-buffer', '【作業 1-2】影像緩衝區管理')"
                    class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden flex flex-col group cursor-pointer relative hover:shadow-2xl transition-all hover:-translate-y-2">
                    <div class="bg-cyan-500 h-2"></div>
                    <div class="p-8 flex-grow">
                        <div class="flex justify-between items-start mb-4">
                            <span class="text-4xl">🖼️</span>
                            <span class="bg-cyan-100 text-cyan-700 text-xs px-2 py-1 rounded font-bold uppercase">60
                                min</span>
                        </div>
                        <h3 class="font-bold text-xl text-gray-800 mb-2 group-hover:text-cyan-600 transition">【作業 1-2】
                        </h3>
                        <h4 class="font-medium text-gray-500 mb-4">大數據存儲管理</h4>
                        <div class="text-sm text-gray-600 space-y-2">
                            <ul class="list-disc list-inside space-y-1">
                                <li><strong>模擬截圖：</strong>申請 640x480x2 的 Frame Buffer。</li>
                                <li><strong>分區處理：</strong>練習使用指標提取 ROI (感興趣區域) 數據。</li>
                                <li><strong>監控：</strong>確保無記憶體洩漏 (Memory Leak)。</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Task 1-3 -->
                <div onclick="openSubmissionModal('adv-01-sensor-debug', '【作業 1-3】感測器與 PSRAM 聯動除錯')"
                    class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden flex flex-col group cursor-pointer relative hover:shadow-2xl transition-all hover:-translate-y-2">
                    <div class="bg-emerald-500 h-2"></div>
                    <div class="p-8 flex-grow">
                        <div class="flex justify-between items-start mb-4">
                            <span class="text-4xl">🛠️</span>
                            <span
                                class="bg-emerald-100 text-emerald-700 text-xs px-2 py-1 rounded font-bold uppercase">45
                                min</span>
                        </div>
                        <h3 class="font-bold text-xl text-gray-800 mb-2 group-hover:text-emerald-600 transition">【作業
                            1-3】
                        </h3>
                        <h4 class="font-medium text-gray-500 mb-4">硬體資源競爭調試</h4>
                        <div class="text-sm text-gray-600 space-y-2">
                            <ul class="list-disc list-inside space-y-1">
                                <li><strong>時鐘調整：</strong>測試 40MHz vs 80MHz PSRAM 對影像雜訊的影響。</li>
                                <li><strong>衝突排除：</strong>觀察大量讀寫是否影響 I2C 中斷響應。</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 py-12 border-t border-gray-700">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-500 text-sm mb-4">&copy; 2026 Vibe Coding. All rights reserved.</p>
            <div class="flex flex-col md:flex-row justify-center items-center gap-6 text-sm text-gray-400">
                <span>進階課程 1 - 單元 1</span>
                <span class="hidden md:inline">|</span>
                <span>講師：Antigravity Assistant</span>
            </div>
        </div>
    </footer>

    <!-- Assignment Guide (Hidden) -->
    <section id="assignment-guide" style="display: none;">
        <h2>作業指引 (Assignment Guide)</h2>

        <h3>作業 1-1：PSRAM 初始化與壓力測試</h3>
        <ul>
            <li><strong>角色扮演：</strong> 硬體工程師。</li>
            <li><strong>執行方式：</strong> 撰寫一段代碼檢測當前硬體是否有 8MB PSRAM，並嘗試分配一個 2MB 的巨大 Buffer，對比內部 RAM 與 PSRAM 的讀寫速度。</li>
            <li><strong>評分重點：</strong> 能否正確區分 `malloc()` 與 `heap_caps_malloc(..., MALLOC_CAP_SPIRAM)` 的差異。</li>
        </ul>

        <h3>作業 1-2：影像緩衝區管理</h3>
        <ul>
            <li><strong>角色扮演：</strong> 系統架構師。</li>
            <li><strong>執行方式：</strong> 模擬一張 VGA 解析度的 Raw 影像 (640x480x2 Bytes)，計算其占用空間，並實作指標移位來提取畫面中央 100x100 的局部區域。</li>
            <li><strong>評分重點：</strong> 記憶體分配是否正確釋放，避免 Memory Leak。</li>
        </ul>

        <h3>作業 1-3：感測器與 PSRAM 聯動除錯</h3>
        <ul>
            <li><strong>角色扮演：</strong> 韌體除錯工程師。</li>
            <li><strong>執行方式：</strong> 觀察在高頻率 SPI 讀寫下，攝影機的 DVP 訊號是否產生干擾，並紀錄系統啟動時的 Heap 剩餘空間。</li>
            <li><strong>評分重點：</strong> 提交一份分析報告，說明不同時鐘頻率下 PSRAM 的穩定性。</li>
        </ul>
    </section>

    <!-- Instructor Guide (Hidden) -->
    <section id="instructor-guide" style="display: none;">
        <!-- NEW: Practical Deployment Recommendations -->
        <div class="guide-section mb-10 p-6 bg-blue-50 border border-blue-100 rounded-xl shadow-inner">
            <h3 class="text-xl font-bold text-blue-900 border-b-2 border-blue-200 pb-3 mb-6 flex items-center gap-2">
                <span>🚀</span> 在 GitHub Classroom 的實戰部署建議
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h4 class="font-bold text-blue-800 text-sm mb-3 flex items-center gap-2">
                        <span class="w-2 h-2 bg-blue-400 rounded-full"></span>
                        A. 範本倉庫 (Template Repo) 結構
                    </h4>
                    <pre
                        class="bg-gray-900 text-gray-100 p-4 rounded-xl text-xs font-mono overflow-x-auto shadow-lg border border-gray-700">
.
├── src/
│   ├── mem_test.cpp      # 包含 PSRAM 壓力測試代碼
│   └── platformio.ini    # 配置 -DBOARD_HAS_PSRAM
├── include/
│   └── camera_config.h   # 攝影機接腳定義
└── README.md             # 實驗紀錄：PSRAM 數據與 Heap 分配</pre>
                </div>
                <div class="space-y-4">
                    <h4 class="font-bold text-blue-800 text-sm mb-3 flex items-center gap-2">
                        <span class="w-2 h-2 bg-blue-400 rounded-full"></span>
                        B. 自動評估 (Autograding) 的設計
                    </h4>
                    <div class="bg-white/60 backdrop-blur-sm p-4 rounded-lg border border-blue-100 space-y-3">
                        <div class="flex gap-3">
                            <span class="text-blue-500">🧠</span>
                            <p class="text-sm text-gray-700"><strong>Heap 檢查：</strong> 透過代碼讀取 <code>FreeHeap()</code> 與
                                <code>PsramSize()</code>，驗證配置成功。</p>
                        </div>
                        <div class="flex gap-3">
                            <span class="text-blue-500">⏱️</span>
                            <p class="text-sm text-gray-700"><strong>速度基準：</strong> 設定讀取 1MB 數據的時間門檻，檢查 PSRAM 讀寫是否達標。
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW: Detailed operations guide -->
        <div class="guide-section mb-10 p-6 bg-white border border-gray-200 rounded-xl shadow-sm">
            <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                <span>🛠️</span> GitHub Classroom 詳細操作指南
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="p-4 bg-slate-50 rounded-lg border border-slate-100 relative">
                    <span
                        class="absolute -top-3 left-4 bg-slate-200 text-slate-700 text-[10px] font-bold px-2 py-0.5 rounded-full">STEP
                        1</span>
                    <p class="font-bold text-slate-800 text-xs mb-2 mt-2">準備範本專案</p>
                    <p class="text-[11px] text-slate-600 leading-relaxed">上傳包含 <code>heap_caps</code> 範例。確保
                        <code>platformio.ini</code> 已加入 PSRAM 支援。</p>
                </div>
                <div class="p-4 bg-slate-50 rounded-lg border border-slate-100 relative">
                    <span
                        class="absolute -top-3 left-4 bg-slate-200 text-slate-700 text-[10px] font-bold px-2 py-0.5 rounded-full">STEP
                        2</span>
                    <p class="font-bold text-slate-800 text-xs mb-2 mt-2">建立 Classroom 作業</p>
                    <p class="text-[11px] text-slate-600 leading-relaxed">建立 Individual Assignment，提供自動化測試腳本。設定作業為
                        Private。</p>
                </div>
                <div class="p-4 bg-slate-50 rounded-lg border border-slate-100 relative">
                    <span
                        class="absolute -top-3 left-4 bg-slate-200 text-slate-700 text-[10px] font-bold px-2 py-0.5 rounded-full">STEP
                        3</span>
                    <p class="font-bold text-slate-800 text-xs mb-2 mt-2">學生端 (Flipped)</p>
                    <p class="text-[11px] text-slate-600 leading-relaxed">領取作業進行記憶體壓力與速度測試。執行 Git Push 觸發自動評核。</p>
                </div>
                <div class="p-4 bg-slate-50 rounded-lg border border-slate-100 relative">
                    <span
                        class="absolute -top-3 left-4 bg-slate-200 text-slate-700 text-[10px] font-bold px-2 py-0.5 rounded-full">STEP
                        4</span>
                    <p class="font-bold text-slate-800 text-xs mb-2 mt-2">教師回饋 (Review)</p>
                    <p class="text-[11px] text-slate-600 leading-relaxed">針對學生對「動態配置」與「靜態配置」的選擇予以回饋。</p>
                </div>
            </div>
        </div>

        <!-- NEW: Flipped classroom strategy table -->
        <div class="guide-section p-6 bg-blue-50/50 border border-blue-100 rounded-xl">
            <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                <span>🔄</span> 翻轉教室的實施策略
            </h3>
            <div class="overflow-hidden rounded-xl border border-gray-200 bg-white shadow-sm">
                <table class="w-full text-sm text-left">
                    <thead class="bg-gray-50 text-gray-700 font-bold border-b border-gray-200">
                        <tr>
                            <th class="px-4 py-3">階段</th>
                            <th class="px-4 py-3">學生行動 (Git Workflow)</th>
                            <th class="px-4 py-3">教師/平台角色</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100 text-gray-600">
                        <tr>
                            <td class="px-4 py-4 font-bold text-slate-800 bg-slate-50/50 w-24 text-center">課前</td>
                            <td class="px-4 py-4">觀看 S3 架構影片，了解 DMA 不佔用 CPU 運作的原理。</td>
                            <td class="px-4 py-4 text-xs">檢查 Dashboard 進度，確認學員掌握圖片佔用的位元組計算。</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-4 font-bold text-blue-800 bg-blue-50/30 w-24 text-center">課中</td>
                            <td class="px-4 py-4">領取 Classroom 作業，進行影像區域切割，並排除指針對齊錯誤。</td>
                            <td class="px-4 py-4 text-xs text-blue-700">即時連線排除阻礙，分享如何解決常見記憶體崩潰問題。</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-4 font-bold text-slate-800 bg-slate-50/50 w-24 text-center">課後</td>
                            <td class="px-4 py-4">優化穩定性測試並 Push，閱讀教師回覆 PR。</td>
                            <td class="px-4 py-4 text-xs">核發最終課程評量與評分。</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <script>
        window.RESOURCES = {
            youtube: "https://www.youtube.com/embed/Rt_z_A3lm40",
            doc: "https://docs.google.com/document/d/e/2PACX-1vRWjke-UKVXUk4eEshh_G8p8QcCnqmLAuCmwtHD4rrE4OehVVTBEG4uNJwu0NZ_-4Q4F7zuy54w9S2u/pub?embedded=true"
        };
    </script>
    <script src="/js/course-shared.js"></script>
</body>

</html>