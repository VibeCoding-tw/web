<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¦–è¦ºå°èˆªå¤§å¸«ï¼šå¾åƒç´ åˆ°æŒ‡ä»¤çš„ç²¾æº–æ˜ å°„</title>
    <!-- Use local style.css -->
    <link rel="stylesheet" href="../style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap"
        rel="stylesheet">
</head>

<body id="page-visual-nav" class="flex flex-col min-h-screen">
    <!-- Navbar -->
    <nav class="navbar">
        <div class="logo">ğŸš€ Vibe Coding</div>
        <ul class="nav-links">
            <li><a href="../index.html">å›é¦–é </a></li>
            <li><a href="../basic.html">åŸºç¤èª²ç¨‹</a></li>
        </ul>
        <div class="menu-toggle" id="mobile-menu">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8 flex-grow max-w-5xl">
        <div class="page-header text-center mb-12">
            <h1 class="text-4xl font-extrabold text-slate-800 tracking-tight mb-2">è¦–è¦ºå°èˆªå¤§å¸«</h1>
            <p class="text-lg text-slate-500">å¾åƒç´ åˆ°æŒ‡ä»¤çš„ç²¾æº–æ˜ å°„ (From Pixels to PWM)</p>
        </div>

        <!-- 1. ç›´è¦ºå¯¦é©—å®¤ -->
        <div class="section-card section-lab">
            <h2 class="text-2xl font-bold text-pink-600 mb-4 flex items-center gap-2">
                <span class="text-3xl">ğŸ§ª</span> 1. èª²å‰æ¢ç´¢ï¼šç›´è¦ºå¯¦é©—å®¤
            </h2>
            <p class="mb-6 text-gray-600">
                å¦‚æœé€™å¼µä¸¦ä¸æ˜¯å€‹äºŒç¶­ç•«é¢ï¼Œè€Œæ˜¯ä¸€å€‹å¯¦é«”çš„å½¢ç‹€ï¼Œä½ è¦ºå¾—æŠŠæ‰‹æŒ‡é ‚åœ¨å“ªå€‹é»ï¼Œé€™å¡Šæ¿å­æœƒå‰›å¥½é”åˆ°ã€Œå®Œç¾å¹³è¡¡ã€ï¼Ÿ
                è©¦è‘—æ‹–æ›³ä¸‹é¢çš„ç´…è‰²è‰²å¡Šï¼Œè§€å¯Ÿ<b>ç¶ è‰²åå­—æº–å¿ƒ (è³ªå¿ƒ)</b> çš„è®ŠåŒ–ï¼
            </p>

            <div class="flex flex-col md:flex-row gap-8 items-center justify-center">
                <div class="relative">
                    <canvas id="labCanvas" width="400" height="300"></canvas>
                    <div
                        class="absolute top-2 right-2 bg-white/80 px-2 py-1 rounded text-xs text-gray-500 shadow pointer-events-none">
                        Canvas: 400x300
                    </div>
                </div>
                <div class="flex-1 space-y-4">
                    <div class="bg-pink-50 p-4 rounded-lg border border-pink-100">
                        <h3 class="font-bold text-pink-700 mb-2">æ•¸æ“šè§€å¯Ÿå„€</h3>
                        <p>ğŸ”´ è‰²å¡Šä¸­å¿ƒ (æ¨¡æ“¬ç‰©é«”)ï¼š<span id="blobStr" class="font-mono text-pink-600">x=200, y=150</span></p>
                        <p>ğŸŸ¢ è³ªå¿ƒè¨ˆç®— (å¹³è¡¡æ”¯é»)ï¼š<span id="centroidStr" class="font-mono text-green-600">x=200, y=150</span>
                        </p>
                        <p class="text-sm text-gray-500 mt-2">
                            ğŸ’¡ æ€è€ƒï¼šç•¶ç‰©é«”è¶Šé è¿‘é‚Šç·£ï¼Œè³ªå¿ƒçš„åº§æ¨™ç™¼ç”Ÿäº†ä»€éº¼è®ŠåŒ–ï¼Ÿé€™å°æ©Ÿå™¨äººåˆ¤æ–·ã€Œæˆ‘åœ¨å“ªè£¡ã€æœ‰ä»€éº¼å•Ÿç™¼ï¼Ÿ
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. æ ¸å¿ƒåŸç† -->
        <div class="section-card section-math">
            <h2 class="text-2xl font-bold text-blue-600 mb-6 flex items-center gap-2">
                <span class="text-3xl">ğŸ“‰</span> 2. æ ¸å¿ƒåŸç†ï¼šæ•¸å­¸çš„ã€Œè®Šèº«è¡“ã€
            </h2>
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <p class="mb-4 text-gray-700">
                        åœ¨é›»è…¦è¦–è¦ºä¸­ï¼Œæˆ‘å€‘ä½¿ç”¨<b>ã€Œå½±åƒçŸ© (Image Moments)ã€</b>ä¾†æè¿°ç‰©é«”çš„å¹¾ä½•ç‰¹å¾µã€‚
                        é€™å…¶å¯¦å°±æ˜¯ç‰©ç†å­¸ä¸­ã€ŒåŠ›çŸ©ã€åœ¨å½±åƒä¸Šçš„æ‡‰ç”¨ã€‚
                    </p>
                    <table class="w-full math-table text-sm">
                        <thead>
                            <tr>
                                <th>ç‰©ç†é‡</th>
                                <th>æ•¸å­¸å®šç¾©</th>
                                <th>å¹¾ä½•æ„ç¾©</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="font-bold">é›¶éšçŸ© ($M_{00}$)</td>
                                <td>$\sum_{x,y} I(x,y)$</td>
                                <td>ç™½è‰²å€åŸŸçš„<b>ç¸½é¢ç©</b> (åƒç´ ç¸½æ•¸)</td>
                            </tr>
                            <tr>
                                <td class="font-bold">ä¸€éšçŸ© ($M_{10}$)</td>
                                <td>$\sum_{x,y} x \cdot I(x,y)$</td>
                                <td>Xè»¸æ–¹å‘çš„è³ªé‡åˆ†ä½ˆ</td>
                            </tr>
                            <tr>
                                <td class="font-bold">ä¸€éšçŸ© ($M_{01}$)</td>
                                <td>$\sum_{x,y} y \cdot I(x,y)$</td>
                                <td>Yè»¸æ–¹å‘çš„è³ªé‡åˆ†ä½ˆ</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="bg-blue-50 p-6 rounded-xl flex flex-col justify-center">
                    <h3 class="text-lg font-bold text-blue-800 mb-4 border-b border-blue-200 pb-2">è³ªå¿ƒè¨ˆç®—å…¬å¼</h3>
                    <div class="text-center text-xl mb-6">
                        $$ C_x = \frac{M_{10}}{M_{00}}, \quad C_y = \frac{M_{01}}{M_{00}} $$
                    </div>
                    <h3 class="text-lg font-bold text-blue-800 mb-4 border-b border-blue-200 pb-2">è¦–è¦ºèª¤å·® (Error)</h3>
                    <div class="text-center text-lg text-gray-700">
                        $$ Error = Target - Current $$
                    </div>
                    <p class="text-sm text-gray-500 mt-2 text-center">
                        æ©Ÿå™¨äººæƒ³æŠŠç›®æ¨™æ”¾åœ¨ç•«é¢æ­£ä¸­å¤®ï¼Œæ‰€ä»¥ Target é€šå¸¸æ˜¯ç•«é¢å¯¬åº¦çš„ä¸€åŠã€‚
                    </p>
                </div>
            </div>
        </div>

        <!-- 3. æ­£è¦åŒ–æŒ‘æˆ° -->
        <div class="section-card section-norm">
            <h2 class="text-2xl font-bold text-emerald-600 mb-4 flex items-center gap-2">
                <span class="text-3xl">ğŸ› ï¸</span> 3. å¯¦æˆ°æŒ‘æˆ°ï¼šæ­£è¦åŒ– (Normalization)
            </h2>
            <p class="mb-6 text-gray-600">
                å¦‚æœæˆ‘å€‘æŠŠç¨‹å¼ç¢¼å¯«æ­»ï¼Œå‡è¨­ç•«é¢ä¸­å¿ƒæ˜¯ 160 (å› ç‚ºå¯¬åº¦320)ï¼Œé‚£æ›äº†ä¸€å€‹ 1280x720 çš„é«˜ç•«è³ªé¡é ­æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ
                <b>è©¦è‘—ç§»å‹•ä¸‹é¢çš„æ»‘é¼ ï¼Œæ¨¡æ“¬ç‰©é«”åœ¨ä¸åŒé¡é ­ä¸‹çš„ä½ç½®ï¼</b>
            </p>

            <div class="grid md:grid-cols-2 gap-8 mb-6">
                <!-- Camera A -->
                <div class="bg-gray-100 p-4 rounded-lg text-center">
                    <h4 class="font-bold text-gray-700 mb-2">ğŸ“· Camera A: ä½è§£æåº¦ (320x240)</h4>
                    <canvas id="camA" width="320" height="240" class="mx-auto bg-black shadow-lg"></canvas>
                    <div class="mt-2 text-sm font-mono text-left bg-white p-2 rounded">
                        <div>Center(Target): 160</div>
                        <div id="camA-raw">Obj X: 0</div>
                        <div id="camA-err" class="text-red-500 font-bold">Error: 0 px</div>
                    </div>
                </div>

                <!-- Camera B -->
                <div class="bg-gray-100 p-4 rounded-lg text-center">
                    <h4 class="font-bold text-gray-700 mb-2">ğŸ¥ Camera B: é«˜è§£æåº¦ (640x480)</h4>
                    <canvas id="camB" width="640" height="480" class="mx-auto bg-black shadow-lg"
                        style="width: 320px; height: 240px;"></canvas> <!-- Visual scaled down -->
                    <div class="mt-2 text-sm font-mono text-left bg-white p-2 rounded">
                        <div>Center(Target): 320</div>
                        <div id="camB-raw">Obj X: 0</div>
                        <div id="camB-err" class="text-red-500 font-bold">Error: 0 px</div>
                    </div>
                </div>
            </div>

            <div class="bg-emerald-50 p-6 rounded-xl border border-emerald-200">
                <h3 class="text-xl font-bold text-emerald-800 mb-2">ğŸš€ æ­£è¦åŒ–è§£æ±ºæ–¹æ¡ˆ</h3>
                <p class="text-emerald-900 mb-4">
                    ç„¡è«–è§£æåº¦å¦‚ä½•ï¼Œæˆ‘å€‘éƒ½å°‡åº§æ¨™æ˜ å°„åˆ° <code class="bg-white px-1 rounded text-emerald-700">[-1.0, 1.0]</code> çš„å€é–“ã€‚
                    é€™æ¨£ PID åƒæ•¸å°±ä¸ç”¨é‡èª¿äº†ï¼
                </p>
                <div
                    class="flex items-center justify-center gap-4 text-3xl font-mono font-bold text-emerald-600 bg-white py-4 rounded-lg shadow-inner">
                    <span>Normalized Error:</span>
                    <span id="norm-val">0.00</span>
                </div>
            </div>
        </div>

    </div>

    <!-- Footer -->
    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-logo">ğŸš€ Vibe Coding</div>
            <p>&copy; 2025 Vibe Coding. All rights reserved.</p>
            <div class="social-links">
                <a href="#">Facebook</a>
                <a href="#">Twitter</a>
                <a href="#">Instagram</a>
            </div>
        </div>
    </footer>

    <script>
        // --- Section 1: Intuitive Lab Logic ---
        const initLab = () => {
            const canvas = document.getElementById('labCanvas');
            const ctx = canvas.getContext('2d');
            let blob = { x: 200, y: 150, r: 30 };
            let isDragging = false;

            const draw = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Draw Grid
                ctx.strokeStyle = '#e2e8f0';
                ctx.beginPath();
                for (let i = 0; i < canvas.width; i += 40) { ctx.moveTo(i, 0); ctx.lineTo(i, canvas.height); }
                for (let i = 0; i < canvas.height; i += 40) { ctx.moveTo(0, i); ctx.lineTo(canvas.width, i); }
                ctx.stroke();

                // Draw Blob (Simulated Object)
                ctx.fillStyle = '#f43f5e'; // Rose-500
                ctx.beginPath();
                ctx.arc(blob.x, blob.y, blob.r, 0, Math.PI * 2);
                ctx.fill();

                // Draw Centroid (Wait... centering on the blob itself is trivial, 
                // but let's pretend we calculated it to reinforce the visual)
                // In image processing, if the blob is perfect circle, centroid IS center.
                const centroidX = blob.x;
                const centroidY = blob.y;

                // Draw Crosshair
                ctx.strokeStyle = '#22c55e'; // Green-500
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(centroidX - 10, centroidY);
                ctx.lineTo(centroidX + 10, centroidY);
                ctx.moveTo(centroidX, centroidY - 10);
                ctx.lineTo(centroidX, centroidY + 10);
                ctx.stroke();

                // Update Text
                document.getElementById('blobStr').innerText = `x=${Math.round(blob.x)}, y=${Math.round(blob.y)}`;
                document.getElementById('centroidStr').innerText = `x=${Math.round(centroidX)}, y=${Math.round(centroidY)}`;
            };

            canvas.addEventListener('mousedown', e => {
                const rect = canvas.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;
                const dist = Math.hypot(mouseX - blob.x, mouseY - blob.y);
                if (dist < blob.r) isDragging = true;
            });
            window.addEventListener('mouseup', () => isDragging = false);
            canvas.addEventListener('mousemove', e => {
                if (!isDragging) return;
                const rect = canvas.getBoundingClientRect();
                blob.x = Math.max(blob.r, Math.min(canvas.width - blob.r, e.clientX - rect.left));
                blob.y = Math.max(blob.r, Math.min(canvas.height - blob.r, e.clientY - rect.top));
                draw();
            });

            draw();
        };

        // --- Section 3: Normalization Logic ---
        const initNorm = () => {
            const cA = document.getElementById('camA');
            const cB = document.getElementById('camB');
            const ctxA = cA.getContext('2d');
            const ctxB = cB.getContext('2d');

            // Virtual object position ratio (0.0 to 1.0)
            let objRatioX = 0.5;
            let objRatioY = 0.5;

            const drawCam = (ctx, w, h, label) => {
                ctx.fillStyle = '#000';
                ctx.fillRect(0, 0, w, h);

                // Grid
                ctx.strokeStyle = '#333';
                ctx.beginPath();
                ctx.moveTo(w / 2, 0); ctx.lineTo(w / 2, h); // Center Line
                ctx.stroke();

                // Object
                const x = objRatioX * w;
                const y = objRatioY * h;

                ctx.fillStyle = '#fbbf24'; // Amber
                ctx.beginPath();
                ctx.arc(x, y, w * 0.05, 0, Math.PI * 2); // Size relative to cam
                ctx.fill();

                // Error Line
                ctx.strokeStyle = '#ef4444';
                ctx.beginPath();
                ctx.moveTo(w / 2, y);
                ctx.lineTo(x, y);
                ctx.stroke();

                // Update UI data for this cam
                const rawErr = Math.round((w / 2) - x); // Error = Target - Current
                document.getElementById(`${label}-raw`).innerText = `Obj X: ${Math.round(x)}`;
                document.getElementById(`${label}-err`).innerText = `Error: ${rawErr} px`;
            };

            const updateAll = () => {
                drawCam(ctxA, 320, 240, 'camA');
                drawCam(ctxB, 640, 480, 'camB'); // Render at full res

                // Normalized Calculation
                // Formula: (Target - Current) / (Width / 2) -> Range [-1, 1]
                // Wait, simpler: (0.5 - ratio) * 2 ?
                // Let's stick to the definition: Error / Max_Error
                // Max Error is Width/2.

                // For Cam A: Error = 160 - x. Max dist is 160.
                // For Cam B: Error = 320 - x. Max dist is 320.

                const normErr = (0.5 - objRatioX) * 2;
                // If Obj is at 0 (Left), ratio=0. norm = 0.5*2 = 1.0
                // If Obj is at 1 (Right), ratio=1, norm = -0.5*2 = -1.0
                // If Obj is Center, ratio=0.5, norm = 0.

                document.getElementById('norm-val').innerText = normErr.toFixed(2);
                document.getElementById('norm-val').className = Math.abs(normErr) < 0.1 ? 'text-green-600 font-bold' : 'text-red-500 font-bold';
            };

            // Interactive Control (Mouse over any cam)
            const handleMove = (e, w, h) => {
                const rect = e.target.getBoundingClientRect();
                // Important: Visual size might differ from internal size for CamB
                const scaleX = w / rect.width;

                const x = (e.clientX - rect.left) * scaleX;
                objRatioX = x / w;
                // Clamp
                objRatioX = Math.max(0, Math.min(1, objRatioX));

                updateAll();
            };

            cA.addEventListener('mousemove', e => { if (e.buttons === 1) handleMove(e, 320, 240); });
            cB.addEventListener('mousemove', e => { if (e.buttons === 1) handleMove(e, 640, 480); });
            // Also allow just hover to showcase easier? Maybe Drag is better.
            // Let's add click/drag support.

            updateAll();
        };

        window.onload = () => {
            initLab();
            initNorm();
        };
    </script>
</body>

</html>