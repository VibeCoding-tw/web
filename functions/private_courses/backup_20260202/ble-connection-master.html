<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web BLE é€£ç·šå¤§å¸«ï¼šéåŒæ­¥çš„æ¡æ‰‹è—è¡“</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>

</head>

<body id="page-ble" class="flex flex-col min-h-screen font-sans bg-slate-50">
    <!-- Navbar -->
    <!-- Navigation (Shared) -->
    <nav class="bg-white/90 backdrop-blur-md shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <a href="/index.html"
                    class="text-2xl font-extrabold text-blue-900 tracking-tight flex items-center gap-2">
                    <span>ğŸš€</span> Vibe Coding
                </a>

                <!-- Desktop Menu -->
                <div class="hidden md:flex items-center space-x-6 font-medium text-gray-600">
                    <a href="/prepare.html" class="hover:text-cyan-600 transition">èª²å‰æº–å‚™</a>
                    <a href="/started.html" class="hover:text-cyan-600 transition">å…¥é–€èª²ç¨‹</a>
                    <a href="/basic.html" class="hover:text-cyan-600 transition">åŸºç¤å¯¦ä½œ</a>
                    <a href="/advanced.html" class="hover:text-cyan-600 transition">é€²éšæ‡‰ç”¨</a>
                </div>

                <!-- Mobile Menu Button -->
                <button id="mobile-menu-btn" class="md:hidden text-gray-600 focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 12h16m-7 6h7"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Mobile Menu Dropdown -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-100">
            <div class="flex flex-col px-4 py-2 space-y-2 font-medium text-gray-600">
                <a href="/prepare.html" class="block py-2 hover:text-cyan-600 transition">èª²å‰æº–å‚™</a>
                <a href="/started.html" class="block py-2 hover:text-cyan-600 transition">å…¥é–€èª²ç¨‹</a>
                <a href="/basic.html" class="block py-2 hover:text-cyan-600 transition">åŸºç¤å¯¦ä½œ</a>
                <a href="/advanced.html" class="block py-2 hover:text-cyan-600 transition">é€²éšæ‡‰ç”¨</a>
            </div>
        </div>
    </nav>
    <script>
        const mobileBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');

        if (mobileBtn && mobileMenu) {
            mobileBtn.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
        }
    </script>

    <div class="container mx-auto px-4 py-8 flex-grow max-w-5xl">
        <div class="page-header text-center mb-12">
            <h1 class="text-4xl font-extrabold text-slate-800 tracking-tight mb-2">Web BLE é€£ç·šå¤§å¸«</h1>
            <p class="text-lg text-slate-500">æŒæ¡éåŒæ­¥ (Async) çš„æ¡æ‰‹è—è¡“ï¼Œå‘Šåˆ¥é€£ç·šå¤±æ•—</p>
        </div>

        <!-- Module 1: Intuitive Lab -->
        <div class="section-card section-lab bg-white p-8 rounded-2xl shadow-sm border border-slate-200 mb-8">
            <h2 class="text-2xl font-bold text-pink-600 mb-4 flex items-center gap-2">
                <span class="text-3xl">ğŸ§ª</span> 1. èª²å‰é«”é©—ï¼šå®‰å…¨æ¡æ‰‹å¯¦é©—å®¤
            </h2>
            <p class="mb-6 text-gray-600">
                è—ç‰™é€£ç·šå°±åƒé€šéå››é“å®‰å…¨é–€ã€‚ä½ å¿…é ˆ<b>æŒ‰é †åº</b>ä¸”<b>ç­‰å¾…</b>å‰ä¸€é“é–€é–‹å•Ÿï¼Œæ‰èƒ½é€²å…¥ä¸‹ä¸€é“ã€‚
                <br>è©¦è‘—é»æ“Šä¸‹æ–¹çš„æŒ‰éˆ•ã€‚å¦‚æœä½ é»å¤ªå¿«ï¼ˆä¸ç­‰è·‘æ¢çµæŸï¼‰ï¼Œé€£ç·šå°±æœƒå¤±æ•—ã€‚
            </p>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6 relative">
                <!-- Data Flow Arrow -->
                <div class="hidden md:block absolute top-1/2 left-0 w-full h-1 bg-gray-200 -z-10 translate-y-[-50%]">
                </div>

                <!-- Step 1 -->
                <div id="step-1"
                    class="step-card border-2 border-gray-200 rounded-xl p-4 flex flex-col items-center bg-white z-10">
                    <div
                        class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center text-xl mb-2 icon-box">
                        ğŸ“¡</div>
                    <h3 class="font-bold text-gray-700 text-sm">1. Request</h3>
                    <div class="text-xs text-gray-500 mb-3 text-center">æœå°‹è£ç½®</div>
                    <button onclick="triggerStep(1)"
                        class="w-full py-2 rounded bg-pink-500 text-white font-bold text-sm hover:bg-pink-600 transition disabled:bg-gray-300 btn-action">
                        æƒæ
                    </button>
                    <div class="w-full h-1 bg-gray-100 mt-3 rounded overflow-hidden">
                        <div class="h-full bg-green-500 w-0 progress-bar"></div>
                    </div>
                </div>

                <!-- Step 2 -->
                <div id="step-2"
                    class="step-card locked border-2 border-gray-200 rounded-xl p-4 flex flex-col items-center bg-white z-10">
                    <div
                        class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center text-xl mb-2 icon-box">
                        ğŸ¤</div>
                    <h3 class="font-bold text-gray-700 text-sm">2. Connect</h3>
                    <div class="text-xs text-gray-500 mb-3 text-center">å»ºç«‹é€£çµ</div>
                    <button onclick="triggerStep(2)" disabled
                        class="w-full py-2 rounded bg-pink-500 text-white font-bold text-sm hover:bg-pink-600 transition disabled:bg-gray-300 btn-action">
                        é€£ç·š
                    </button>
                    <div class="w-full h-1 bg-gray-100 mt-3 rounded overflow-hidden">
                        <div class="h-full bg-green-500 w-0 progress-bar"></div>
                    </div>
                </div>

                <!-- Step 3 -->
                <div id="step-3"
                    class="step-card locked border-2 border-gray-200 rounded-xl p-4 flex flex-col items-center bg-white z-10">
                    <div
                        class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center text-xl mb-2 icon-box">
                        ğŸ“‚</div>
                    <h3 class="font-bold text-gray-700 text-sm">3. Service</h3>
                    <div class="text-xs text-gray-500 mb-3 text-center">å–å¾—æœå‹™</div>
                    <button onclick="triggerStep(3)" disabled
                        class="w-full py-2 rounded bg-pink-500 text-white font-bold text-sm hover:bg-pink-600 transition disabled:bg-gray-300 btn-action">
                        æŸ¥æ‰¾
                    </button>
                    <div class="w-full h-1 bg-gray-100 mt-3 rounded overflow-hidden">
                        <div class="h-full bg-green-500 w-0 progress-bar"></div>
                    </div>
                </div>

                <!-- Step 4 -->
                <div id="step-4"
                    class="step-card locked border-2 border-gray-200 rounded-xl p-4 flex flex-col items-center bg-white z-10">
                    <div
                        class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center text-xl mb-2 icon-box">
                        ğŸ“</div>
                    <h3 class="font-bold text-gray-700 text-sm">4. Char</h3>
                    <div class="text-xs text-gray-500 mb-3 text-center">ç‰¹å¾µå€¼å¯«å…¥</div>
                    <button onclick="triggerStep(4)" disabled
                        class="w-full py-2 rounded bg-pink-500 text-white font-bold text-sm hover:bg-pink-600 transition disabled:bg-gray-300 btn-action">
                        å–å¾—
                    </button>
                    <div class="w-full h-1 bg-gray-100 mt-3 rounded overflow-hidden">
                        <div class="h-full bg-green-500 w-0 progress-bar"></div>
                    </div>
                </div>
            </div>

            <div id="lab-message" class="bg-gray-100 p-3 rounded-lg text-sm text-center font-mono text-gray-600">
                ç­‰å¾…æ“ä½œ...
            </div>
            <div class="text-center mt-4">
                <button onclick="resetLab()" class="text-sm text-gray-400 underline hover:text-gray-600">é‡ç½®å¯¦é©—</button>
            </div>
        </div>

        <!-- Module 2: Core Principles -->
        <div class="section-card section-core bg-white p-8 rounded-2xl shadow-sm border border-slate-200 mb-8">
            <h2 class="text-2xl font-bold text-blue-600 mb-6 flex items-center gap-2">
                <span class="text-3xl">ğŸ“‰</span> 2. æ ¸å¿ƒåŸç†ï¼šé€šè¨Šå”å®šçš„æ¬Šè¡¡
            </h2>

            <!-- Protocol Table -->
            <div class="mb-8 overflow-hidden rounded-lg border border-gray-200">
                <table class="min-w-full text-sm text-left">
                    <thead class="bg-gray-50 text-gray-700 font-bold border-b">
                        <tr>
                            <th class="px-4 py-3">ç‰¹æ€§</th>
                            <th class="px-4 py-3 text-blue-600">Bluetooth LE (BLE)</th>
                            <th class="px-4 py-3 text-purple-600">Wi-Fi (HTTP/WS)</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200 bg-white">
                        <tr>
                            <td class="px-4 py-3 font-bold">é€£ç·šæ–¹å¼</td>
                            <td class="px-4 py-3">é»å°é» (P2P)ï¼Œç„¡éœ€è·¯ç”±å™¨</td>
                            <td class="px-4 py-3">éœ€é€é AP (è·¯ç”±å™¨) æˆ– SoftAP</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-3 font-bold">æ•¸æ“šå°åŒ…</td>
                            <td class="px-4 py-3">å°å°åŒ… (~20 bytes)ï¼Œå³æ™‚æ€§é«˜</td>
                            <td class="px-4 py-3">å¤§å°åŒ…ï¼Œé©åˆä¸²æµä½†åœ¨å€ç¶²æœ‰å»¶é²</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-3 font-bold">è€—é›»é‡</td>
                            <td class="px-4 py-3 text-green-600">æ¥µä½ (å¯è·‘æ•¸æœˆ)</td>
                            <td class="px-4 py-3 text-red-500">é«˜ (è€—é›»å¿«)</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-3 font-bold">é©ç”¨å ´æ™¯</td>
                            <td class="px-4 py-3">å³æ™‚é™æ§ã€å‚³æ„Ÿå™¨è®€å€¼</td>
                            <td class="px-4 py-3">å½±åƒå‚³è¼¸ (Camera)ã€å¤§æª”å‚³è¼¸</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Command Lifecycle Animation -->
            <h3 class="text-lg font-bold text-gray-700 mb-4">æŒ‡ä»¤çš„ç”Ÿå‘½é€±æœŸ (Command Lifecycle)</h3>
            <div
                class="bg-slate-900 p-6 rounded-xl relative overflow-hidden h-[200px] flex items-center justify-between px-12 md:px-24">

                <!-- Web Side -->
                <div class="text-center z-10">
                    <div
                        class="w-16 h-16 bg-blue-500 rounded-lg flex items-center justify-center text-3xl shadow-lg border-2 border-blue-400">
                        ğŸ’»
                    </div>
                    <div class="text-white text-xs mt-2 font-bold">Web App</div>
                </div>

                <!-- Air / Path -->
                <div class="flex-grow h-1 bg-slate-700 mx-4 relative rounded">
                    <!-- The Packet -->
                    <div id="lifecycle-packet"
                        class="packet top-[50%] left-0 transform -translate-y-[50%] -translate-x-[50%] z-20"></div>
                </div>

                <!-- ESP32 Side -->
                <div class="text-center z-10">
                    <div
                        class="w-16 h-16 bg-emerald-500 rounded-lg flex items-center justify-center text-3xl shadow-lg border-2 border-emerald-400">
                        ğŸ¤–
                    </div>
                    <div class="text-white text-xs mt-2 font-bold">ESP32</div>
                </div>

                <!-- Simulation Controls -->
                <div class="absolute bottom-4 left-0 w-full text-center">
                    <div class="inline-flex bg-slate-800 rounded-full p-1 border border-slate-600">
                        <input type="text" id="cmd-input" value="F,100"
                            class="bg-transparent text-white px-3 py-1 text-sm outline-none font-mono w-24 text-center"
                            readonly>
                        <button onclick="runLifecycle()"
                            class="bg-blue-600 text-white px-4 py-1 rounded-full text-sm font-bold hover:bg-blue-500 transition">
                            ç™¼é€æŒ‡ä»¤
                        </button>
                    </div>
                </div>

                <!-- Status Overlay -->
                <div id="lifecycle-status"
                    class="absolute top-4 left-0 w-full text-center text-slate-400 text-xs font-mono">
                    ç­‰å¾…ç™¼é€...
                </div>
            </div>
        </div>

        <!-- Module 3: Practical Challenge -->
        <div class="section-card section-challenge bg-white p-8 rounded-2xl shadow-sm border border-slate-200">
            <h2 class="text-2xl font-bold text-emerald-600 mb-4 flex items-center gap-2">
                <span class="text-3xl">ğŸ› ï¸</span> 3. å¯¦æˆ°æŒ‘æˆ°ï¼šéåŒæ­¥é™·é˜±
            </h2>
            <p class="mb-6 text-gray-600">
                ä¸‹æ–¹çš„ç¨‹å¼ç¢¼æœ‰ä¸€å€‹åš´é‡çš„ Bugï¼š<b>æ®­å±è»Šæ•ˆæ‡‰</b>ã€‚
                <br>å› ç‚ºæ²’æœ‰ç­‰å¾… Request å®Œæˆå°±æƒ³é€£ç·šï¼Œæˆ–è€…æ²’ç­‰å¾…é€£æ¥å°±æƒ³å¯«å…¥ï¼Œå°è‡´ç¨‹å¼å´©æ½°ï¼Œè»Šå­åœä¸ä¸‹ä¾†ã€‚
                <br><b>ä»»å‹™ï¼šé»æ“Šè™›ç·šæ¡†æ¡†ï¼Œè£œä¸Š `await` é—œéµå­—ï¼Œä¿®å¾©é€™æ®µç¨‹å¼ç¢¼ã€‚</b>
            </p>

            <div class="grid md:grid-cols-2 gap-8">
                <!-- Code Editor -->
                <div
                    class="bg-slate-800 rounded-xl p-6 font-mono text-sm text-gray-300 relative overflow-hidden shadow-inner">
                    <div
                        class="absolute top-0 left-0 w-full bg-slate-700 px-4 py-2 text-xs text-gray-400 font-bold flex justify-between">
                        <span>main.js</span>
                        <span>JavaScript</span>
                    </div>
                    <div class="mt-6 space-y-2">
                        <div class="code-line group">
                            <span class="text-purple-400">async function</span> <span
                                class="text-yellow-400">connectCar</span>() {
                        </div>
                        <div class="code-line pl-4 group" onclick="toggleAwait(this)">
                            <span class="text-blue-400">const</span> device = <span
                                class="slot missing-await"></span>navigator.bluetooth.requestDevice(...);
                        </div>
                        <div class="code-line pl-4 group" onclick="toggleAwait(this)">
                            <span class="text-blue-400">const</span> server = <span
                                class="slot missing-await"></span>device.gatt.connect();
                        </div>
                        <div class="code-line pl-4 group" onclick="toggleAwait(this)">
                            <span class="text-blue-400">const</span> service = <span
                                class="slot missing-await"></span>server.getPrimaryService(UUID);
                        </div>
                        <div class="code-line pl-4 group" onclick="toggleAwait(this)">
                            char = <span class="slot missing-await"></span>service.getCharacteristic(UUID);
                        </div>
                        <div class="code-line pl-4">
                            <span class="text-gray-500">// é€£ç·šæˆåŠŸï¼</span>
                        </div>
                        <div class="code-line">}</div>
                    </div>
                </div>

                <!-- Result Console -->
                <div class="flex flex-col justify-between">
                    <div id="console-output"
                        class="bg-black rounded-xl p-4 font-mono text-xs h-40 overflow-y-auto mb-4 text-green-400 border border-gray-800">
                        > System Ready...<br>
                        > Waiting for code fix...
                    </div>
                    <button onclick="runCodeChallenge()"
                        class="w-full py-3 bg-emerald-500 text-white rounded-xl font-bold shadow-lg hover:bg-emerald-600 transition transform active:scale-95 flex items-center justify-center gap-2">
                        <span class="text-xl">â–¶ï¸</span> åŸ·è¡Œç¨‹å¼ç¢¼
                    </button>
                    <p class="text-xs text-gray-500 mt-2 text-center">
                        æç¤ºï¼šæ¯ä¸€å€‹æ¶‰åŠç¡¬é«”é€šè¨Šçš„æ­¥é©Ÿéƒ½éœ€è¦æ™‚é–“ï¼Œå¿…é ˆç­‰å¾… (await)ã€‚
                    </p>
                </div>
            </div>
        </div>

    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-logo">ğŸš€ Vibe Coding</div>
            <p>&copy; 2025 Vibe Coding. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // --- Module 1: Intuitive Lab Logic ---
        let currentStep = 0;
        let isProcessing = false;
        // Delays for each step in ms
        const delays = [800, 1500, 1000, 600];

        function triggerStep(stepIndex) {
            // Check order
            if (stepIndex !== currentStep + 1) {
                if (stepIndex > currentStep + 1) {
                    showLabMessage(`âŒ éŒ¯èª¤ï¼šä¸èƒ½è·³é—œï¼è«‹å…ˆå®Œæˆæ­¥é©Ÿ ${currentStep + 1}`, 'text-red-500');
                }
                return;
            }

            if (isProcessing) {
                showLabMessage('âš ï¸ å¿™ç¢Œä¸­ï¼šä¸Šä¸€æ­¥é‚„æ²’å®Œæˆï¼(Async Error)', 'text-orange-500');
                shakeCard(stepIndex);
                return;
            }

            // Start Process
            isProcessing = true;
            const card = document.getElementById(`step-${stepIndex}`);
            const progressBar = card.querySelector('.progress-bar');
            const btn = card.querySelector('.btn-action');

            card.classList.add('active');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> è™•ç†ä¸­...';

            showLabMessage(`â³ æ­£åœ¨åŸ·è¡Œ Step ${stepIndex}... (awaiting)`, 'text-blue-500');

            // Simulating Async Delay with Animation
            progressBar.style.transition = `width ${delays[stepIndex - 1]}ms linear`;
            requestAnimationFrame(() => {
                progressBar.style.width = '100%';
            });

            setTimeout(() => {
                // Success
                isProcessing = false;
                currentStep = stepIndex;
                btn.innerHTML = 'âœ… å®Œæˆ';
                btn.disabled = true;

                card.classList.remove('active');
                card.classList.add('success');

                showLabMessage(`âœ… Step ${stepIndex} æˆåŠŸï¼å¯ä»¥é€²è¡Œä¸‹ä¸€æ­¥ã€‚`, 'text-green-600');

                // Unlock next step
                if (stepIndex < 4) {
                    const nextCard = document.getElementById(`step-${stepIndex + 1}`);
                    nextCard.classList.remove('locked');
                    const nextBtn = nextCard.querySelector('.btn-action');
                    nextBtn.disabled = false;
                } else {
                    showLabMessage('ğŸ‰ æ­å–œï¼å®Œæ•´é€£ç·šå»ºç«‹æˆåŠŸï¼', 'text-pink-600 font-bold');
                    confettiEffect();
                }

            }, delays[stepIndex - 1]);
        }

        function showLabMessage(msg, colorClass) {
            const el = document.getElementById('lab-message');
            el.innerHTML = msg;
            el.className = `p-3 rounded-lg text-sm text-center font-mono bg-gray-100 ${colorClass}`;
        }

        function shakeCard(id) {
            const card = document.getElementById(`step-${id}`);
            card.classList.add('animate-pulse', 'border-red-400');
            setTimeout(() => card.classList.remove('animate-pulse', 'border-red-400'), 500);
        }

        function resetLab() {
            currentStep = 0;
            isProcessing = false;
            showLabMessage('ç­‰å¾…æ“ä½œ...', 'text-gray-600');
            for (let i = 1; i <= 4; i++) {
                const card = document.getElementById(`step-${i}`);
                const bar = card.querySelector('.progress-bar');
                const btn = card.querySelector('.btn-action');

                // Reset styles
                card.classList.remove('active', 'success');
                bar.style.transition = 'none';
                bar.style.width = '0';

                if (i === 1) {
                    card.classList.remove('locked');
                    btn.disabled = false;
                    btn.innerText = 'æƒæ';
                } else {
                    card.classList.add('locked');
                    btn.disabled = true;
                    // Reset button text
                    const texts = ['', 'æƒæ', 'é€£ç·š', 'æŸ¥æ‰¾', 'å–å¾—'];
                    btn.innerText = texts[i];
                }
            }
        }

        // --- Module 2: Lifecycle Animation ---
        function runLifecycle() {
            const packet = document.getElementById('lifecycle-packet');
            const status = document.getElementById('lifecycle-status');
            const btn = document.querySelector('#lifecycle-packet + button'); // crude selection of button

            packet.style.display = 'block';
            packet.style.left = '0%';

            // 1. Serialize
            status.innerText = "1. åºåˆ—åŒ– (Serialization)...";
            status.className = "absolute top-4 left-0 w-full text-center text-blue-400 text-xs font-mono font-bold";

            setTimeout(() => {
                // 2. Transmit
                status.innerText = "2. ç©ºä¸­å‚³è¼¸ (Transmission)...";
                status.className = "absolute top-4 left-0 w-full text-center text-purple-400 text-xs font-mono font-bold";
                packet.style.transition = "left 1.5s ease-in-out";
                packet.style.left = "100%";
            }, 500);

            setTimeout(() => {
                // 3. Parse
                status.innerText = "3. è§£æåŸ·è¡Œ (Execution)!";
                status.className = "absolute top-4 left-0 w-full text-center text-emerald-400 text-xs font-mono font-bold";
                packet.style.display = 'none';

                // ESP32 Flash effect
                const espIcon = document.querySelector('.section-core .bg-emerald-500');
                espIcon.classList.add('ring-4', 'ring-emerald-300', 'scale-110');
                setTimeout(() => espIcon.classList.remove('ring-4', 'ring-emerald-300', 'scale-110'), 300);

            }, 2000);

            setTimeout(() => {
                status.innerText = "ç­‰å¾…ç™¼é€...";
                status.className = "absolute top-4 left-0 w-full text-center text-slate-400 text-xs font-mono";
                packet.style.transition = "none";
                packet.style.left = "0%";
            }, 3000);
        }

        // --- Module 3: Challenge Logic ---
        function toggleAwait(row) {
            const slot = row.querySelector('.slot');
            if (!slot) return;

            if (slot.classList.contains('missing-await')) {
                slot.className = 'slot await-badge';
                slot.innerText = 'await';
            } else {
                slot.className = 'slot missing-await';
                slot.innerText = '';
            }
        }

        function runCodeChallenge() {
            const slots = document.querySelectorAll('.slot');
            let missingCount = 0;
            slots.forEach(s => {
                if (s.classList.contains('missing-await')) missingCount++;
            });

            const consoleDiv = document.getElementById('console-output');

            if (missingCount === 0) {
                consoleDiv.innerHTML += `<div class="text-emerald-300 mt-2">> Code checks passed!<br>> Connection stable.<br>> Car is moving safely. âœ…</div>`;
            } else {
                consoleDiv.innerHTML += `<div class="text-red-400 mt-2">> ERROR: Unhandled Promise Rejection!<br>> "device" is undefined.<br>> ğŸ§Ÿ ZOMBIE CAR DETECTED! (Crashed)</div>`;
            }
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        // --- Utils ---
        function confettiEffect() {
            const colors = ['#f472b6', '#60a5fa', '#34d399'];
            for (let i = 0; i < 30; i++) {
                const el = document.createElement('div');
                el.style.position = 'fixed';
                el.style.left = '50%';
                el.style.top = '50%';
                el.style.width = '10px';
                el.style.height = '10px';
                el.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                el.style.transform = `translate(${Math.random() * 300 - 150}px, ${Math.random() * 300 - 150}px)`;
                el.style.transition = 'all 1s ease-out';
                el.style.borderRadius = '50%';
                el.style.zIndex = '9999';
                document.body.appendChild(el);
                setTimeout(() => {
                    el.style.opacity = '0';
                    setTimeout(() => el.remove(), 100);
                }, 900);
            }
        }

    </script>
</body>

</html>