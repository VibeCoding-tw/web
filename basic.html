<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸºç¤èª²ç¨‹ï¼šé¦¬é”æ§åˆ¶ã€é€šè¨Šèˆ‡ OTA å¯¦ä½œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    
    <style>
        /* åŸºç¤æ¨£å¼ (ä½¿ç”¨ Tailwind çš„ reset) */
        body { 
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: #f7fafc; /* èˆ‡ä¸»é ä¸€è‡´çš„æ·ºç° */
            color: #333; 
        }
        
        /* é é¢æ¨™é¡Œæ¨£å¼ (èˆ‡ prepare.html ä¸€è‡´) */
        .page-header h1 { 
            color: #1e3a8a; 
            text-align: center; 
            margin-bottom: 10px; 
        }
        .section-title-underline {
            height: 4px;
            width: 80px;
            background-color: #06b6d4; 
            margin: 0 auto 2rem;
            border-radius: 2px;
        }

        /* èª²ç¨‹ç¶²æ ¼èˆ‡å¡ç‰‡ */
        .lesson-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 30px; 
            margin-top: 2rem;
        }
        .lesson-card { 
            background-color: #fff; 
            border-radius: 12px; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: transform 0.3s ease, box-shadow 0.3s ease; 
            height: 100%; 
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-top: 4px solid #28a745; /* åŸºç¤èª²ç¨‹ç¶­æŒç¶ è‰²èª¿ */
        }
        .lesson-card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .lesson-header { 
            background-color: #e9fff0; 
            padding: 15px 20px; 
            border-bottom: 1px solid #e5e7eb; 
        }
        .lesson-header h2 { 
            margin: 0; 
            font-size: 1.25em; 
            color: #166534; /* æ·±ç¶ è‰²æ¨™é¡Œ */
            font-weight: 700;
        }
        .lesson-body { 
            padding: 20px; 
            flex-grow: 1; 
            display: flex; 
            flex-direction: column; 
        }
        .lesson-icon { 
            width: 50px; 
            height: 50px; 
            background-color: #28a745; 
            color: #fff; 
            border-radius: 50%; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            font-size: 2em; 
            margin-bottom: 15px; 
        }
        .phase-tag { 
            display: inline-block; 
            background-color: #64748b; 
            color: #fff; 
            padding: 5px 10px; 
            border-radius: 5px; 
            font-size: 0.8em; 
            margin-bottom: 10px; 
        }
        .core-content { 
            margin-top: 15px; 
            font-size: 0.9em; 
            color: #4b5563; 
            flex-grow: 1;
        }
        .core-content ul { 
            list-style: disc; 
            padding-left: 20px; 
            margin: 5px 0 0 0; 
        }
        .duration { 
            font-style: italic; 
            color: #6b7280; 
            margin-top: 5px; 
            font-size: 0.9em; 
        }
        
        /* å‹•æ…‹æŒ‰éˆ•æ¨£å¼ */
        .action-btn { 
            margin-top: 20px; 
            width: 100%; 
            padding: 10px; 
            border-radius: 6px; 
            font-weight: 600; 
            transition: background-color 0.2s;
            cursor: pointer;
        }

        /* ä¸‹æ‹‰é¸å–®æ¨£å¼ */
        .dropdown:hover .dropdown-menu {
            display: block;
        }

        /* éš±è—æ’­æ”¾å™¨å®¹å™¨ï¼Œç›´åˆ°è¢«è§¸ç™¼ */
        /*
        #video-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 0; height: 0;
            z-index: -1;
        }
        */
        #video-overlay {
            display: none; 
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 9999;
            background-color: black; 
        }
        
        /* ç¢ºä¿ iframe å……æ»¿å®¹å™¨ */
        #video-overlay iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* æ–°å¢ï¼šè‡ªè¨‚é—œé–‰æŒ‰éˆ•æ¨£å¼ */
        .close-video-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10000; /* ç¢ºä¿åœ¨ iframe ä¸Šæ–¹ */
            background-color: rgba(0, 0, 0, 0.6); /* åŠé€æ˜é»‘åº• */
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50px;
            padding: 8px 16px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            backdrop-filter: blur(4px); /* æ¯›ç»ç’ƒæ•ˆæœ */
        }
        
        /* æ‰‹æ©Ÿç‰ˆå„ªåŒ–ï¼šè®“æŒ‰éˆ•æ›´å¤§ï¼Œæ¯”è¼ƒå¥½æŒ‰ */
        @media (max-width: 768px) {
            .close-video-btn {
                top: 15px;
                right: 15px;
                padding: 10px 20px; /* åŠ å¤§è§¸æ§ç¯„åœ */
                font-size: 18px;
            }
        }
    </style>
</head>
<body>

    <script>
        // ä½¿ç”¨ fetch å»è®€å–æ—é‚Šçš„ lessons.json æª”æ¡ˆ
        fetch('./lessons.json')
            .then(response => response.json()) // æŠŠæ–‡å­—è½‰æˆ JSON ç‰©ä»¶
            .then(data => {
                // è³‡æ–™è®€å–æˆåŠŸå¾Œï¼Œå‘¼å«æ¸²æŸ“å‡½æ•¸
                renderLessons(data);
            })
            .catch(error => console.error('è³‡æ–™è®€å–å¤±æ•—:', error));
    </script>
</body>
<body class="flex flex-col min-h-screen">

    <nav class="bg-white/90 backdrop-blur-md shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <a href="index.html" class="text-2xl font-extrabold text-blue-900 tracking-tight flex items-center gap-2">
                    <span>ğŸš€</span> Vibe Coding
                </a>

                <div class="hidden md:flex items-center space-x-6 font-medium text-gray-600">
                    <div class="relative dropdown group">
                        <button class="flex items-center hover:text-cyan-600 transition cursor-pointer py-2">
                            èª²ç¨‹é€£çµ <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="dropdown-menu absolute hidden bg-white shadow-xl rounded-lg py-2 w-48 mt-0 border border-gray-100 left-0">
                            <a href="prepare.html" class="block px-4 py-2 hover:bg-cyan-50 hover:text-cyan-700">èª²å‰æº–å‚™</a>
                            <a href="started.html" class="block px-4 py-2 hover:bg-cyan-50 hover:text-cyan-700">å…¥é–€èª²ç¨‹</a>
                            <a href="basic.html" class="block px-4 py-2 hover:bg-cyan-50 hover:text-cyan-700">åŸºç¤å¯¦ä½œ</a>
                            <a href="advanced.html" class="block px-4 py-2 hover:bg-cyan-50 hover:text-cyan-700">é€²éšæ‡‰ç”¨</a>
                        </div>
                    </div>

                    <div class="relative dropdown group">
                        <button class="flex items-center hover:text-cyan-600 transition cursor-pointer py-2">
                            çµ„æ…‹è¨­å®š <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="dropdown-menu absolute hidden bg-white shadow-xl rounded-lg py-2 w-48 mt-0 border border-gray-100 left-0">
                            <a href="wifi-config.html" class="block px-4 py-2 hover:bg-cyan-50 hover:text-cyan-700">WiFi è¨­å®š</a>
                            <a href="motor-config.html" class="block px-4 py-2 hover:bg-cyan-50 hover:text-cyan-700">é¦¬é”è¨­å®š</a>
                        </div>
                    </div>

                    <a href="about.html" class="hover:text-cyan-600 transition">é—œæ–¼æˆ‘å€‘</a>
                </div>

                <div class="flex items-center space-x-4">
                    <a href="cart.html" class="text-gray-600 hover:text-cyan-600 transition duration-150 relative" title="å‰å¾€è³¼ç‰©è»Š">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.2 4h12.4M15 13H7" />
                        </svg>
                    </a>
                    
                    <div id="auth-status" class="text-sm flex items-center">
                        <span id="user-display" class="text-gray-600 hidden md:inline mr-2">è¨ªå®¢</span>
                        <button id="login-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white text-sm py-2 px-4 rounded-full transition shadow-md">ç™»å…¥</button>
                    </div>

                    <div class="md:hidden ml-2">
                        <button id="mobile-menu-btn" class="text-gray-600 focus:outline-none p-2 border rounded hover:bg-gray-100">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                        </button>
                    </div>
                </div>
            </div>

            <div id="mobile-menu" class="hidden md:hidden pb-4 border-t border-gray-100 mt-2">
                <div class="flex flex-col space-y-3 pt-4 font-medium text-gray-600">
                    <a href="prepare.html" class="hover:text-cyan-600 pl-2">èª²å‰æº–å‚™</a>
                    <a href="started.html" class="hover:text-cyan-600 pl-2">å…¥é–€èª²ç¨‹</a>
                    <a href="basic.html" class="text-cyan-600 font-bold pl-2">åŸºç¤å¯¦ä½œ</a>
                    <a href="advanced.html" class="hover:text-cyan-600 pl-2">é€²éšæ‡‰ç”¨</a>
                    
                    <div class="pl-2 border-l-2 border-gray-200 ml-2">
                        <p class="text-xs text-gray-400 mb-1 uppercase">çµ„æ…‹è¨­å®š</p>
                        <a href="wifi-config.html" class="block py-1 hover:text-cyan-600">WiFi è¨­å®š</a>
                        <a href="motor-config.html" class="block py-1 hover:text-cyan-600">é¦¬é”è¨­å®š</a>
                    </div>

                    <a href="about.html" class="hover:text-cyan-600 pl-2">é—œæ–¼æˆ‘å€‘</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8 flex-grow">
        
        <div class="page-header text-center mb-10">
            <h1 class="text-3xl font-bold text-gray-800">âš™ï¸ åŸºç¤èª²ç¨‹ï¼šé¦¬é”æ§åˆ¶ã€é€šè¨Šèˆ‡ OTA å¯¦ä½œ</h1>
            <div class="section-title-underline"></div>
        </div>

        <div class="lesson-grid">
            <div id="lesson-container"></div>
            <div id="video-overlay"></div>

            <div class="lesson-card" id="lesson-C2_L1" data-course-id="rs7hx3nf" data-course-name="é–‹ç™¼ç’°å¢ƒè¨­å®šèˆ‡ç¡¬é«”å°è¦½" data-course-price="1500" data-classroom-url="https://classroom.google.com/c/ODM2Nzk0MzYzODQx?cjc=rs7hx3nf">
                <div class="lesson-header"><h2>ç¬¬ 1 èª²ï¼šé–‹ç™¼ç’°å¢ƒè¨­å®šèˆ‡ç¡¬é«”å°è¦½ <span class="duration text-sm font-normal text-gray-500">(3H)</span></h2></div>
                <div class="lesson-body">
                    <div class="flex items-center gap-3"> 
                        <div class="lesson-icon text-4xl bg-blue-50 p-2 rounded-lg">ğŸ–¥ï¸</div>                        
                        <span class="phase-tag bg-indigo-100 text-indigo-700 text-xs font-bold px-2 py-1 rounded">
                            åœ¨æ¢è¨å¾®æ§åˆ¶å™¨ï¼ˆMicrocontroller Unit, MCUï¼‰å¦‚ä½•æ„ŸçŸ¥ä¸–ç•Œä¹‹å‰ï¼Œæˆ‘å€‘å¿…é ˆå…ˆå¾æœ¬é«”è«–çš„è§’åº¦ç†è§£ç‰©ç†è¨Šè™Ÿçš„æœ¬è³ªã€‚æˆ‘å€‘æ‰€è™•çš„å®‡å®™ï¼Œåœ¨å®è§€å°ºåº¦ä¸‹æ˜¯é€£çºŒçš„ï¼ˆContinuousï¼‰ã€‚
                        </span>
                    </div>
                    <div class="core-content"><strong>æ ¸å¿ƒå…§å®¹ï¼š</strong><ul><li>è»Ÿé«”å®‰è£ï¼šVS Codeã€PlatformIO IDE å®‰è£èˆ‡è¨­å®šã€‚</li><li>ç¡¬é«”æ¦‚è§€ï¼šèªè­˜ ESP32ã€ç›´æµé¦¬é”ã€é©…å‹•æ¨¡çµ„ï¼ˆH æ©‹ï¼‰åŠè»Šé«”çµæ§‹ã€‚</li></ul></div>
                    <button onclick="playFullScreenVideo('FZdPlTtfniM')" 
                        class="flex-1 py-2 px-3 rounded-md border border-red-500 text-red-600 font-medium hover:bg-red-50 transition-colors flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/></svg>
                        èª²ç¨‹é è¦½
                    </button>
                    <button id="action-btn-C2_L1" class="action-btn bg-gray-400 text-white" disabled>è¼‰å…¥ä¸­...</button>
                </div>
            </div>

            <div class="lesson-card" id="lesson-C2_L9" data-course-id="3dsinq2j" data-course-name="OTA ç„¡ç·šæ›´æ–°æ¶æ§‹èˆ‡å¯¦å‹™" data-course-price="1500" data-classroom-url="https://classroom.google.com/c/ODM2Nzk2NTc4MDMw?cjc=3dsinq2j">
                <div class="lesson-header"><h2>ç¬¬ 2 èª²ï¼šOTA ç„¡ç·šæ›´æ–°æ¶æ§‹èˆ‡å¯¦å‹™ <span class="duration text-sm font-normal text-gray-500">(3H)</span></h2></div>
                <div class="lesson-body"><div class="lesson-icon" title="Update Icon">â¬†ï¸</div><span class="phase-tag self-start">V. éŸŒé«”æ¶æ§‹èˆ‡ç¶­è­·</span><div class="core-content"><strong>æ ¸å¿ƒå…§å®¹ï¼š</strong><ul><li>é›™åˆ†å€æ¶æ§‹ï¼šLauncher App èˆ‡ User Appã€‚</li><li>Launcher Appï¼šå¯¦ä½œ Launcher é‚è¼¯ã€‚</li></ul></div><button id="action-btn-C2_L9" class="action-btn bg-gray-400 text-white" disabled>è¼‰å…¥ä¸­...</button></div>
            </div>
            <div class="lesson-card" id="lesson-C2_L2" data-course-id="pxyzdlw3" data-course-name="åŸºç¤èªæ³•èˆ‡æ•¸ä½é¡æ¯” I/O" data-course-price="1500" data-classroom-url="https://classroom.google.com/c/ODM2Nzk0NjQxNTI5?cjc=pxyzdlw3">
                <div class="lesson-header"><h2>ç¬¬ 3 èª²ï¼šC/C++ åŸºç¤èªæ³•èˆ‡æ•¸ä½é¡æ¯” I/O <span class="duration text-sm font-normal text-gray-500">(3H)</span></h2></div>
                <div class="lesson-body"><div class="lesson-icon" title="Code Icon">ğŸ’»</div><span class="phase-tag self-start">I. æº–å‚™èˆ‡åŸºç¤ I/O</span><div class="core-content"><strong>æ ¸å¿ƒå…§å®¹ï¼š</strong><ul><li>Arduino æ¡†æ¶ï¼š`setup()` èˆ‡ `loop()` å‡½å¼ã€‚</li><li>æ•¸ä½ I/Oï¼šæ§åˆ¶ LED ç‡ˆã€‚</li></ul></div><button id="action-btn-C2_L2" class="action-btn bg-gray-400 text-white" disabled>è¼‰å…¥ä¸­...</button></div>
            </div>
            <div class="lesson-card" id="lesson-C2_L3" data-course-id="oz66t3sj" data-course-name="PWM åŸç†èˆ‡é¦¬é”é€Ÿåº¦æ§åˆ¶" data-course-price="1500" data-classroom-url="https://classroom.google.com/c/ODM2Nzk1MDIyMjY1?cjc=oz66t3sj">
                <div class="lesson-header"><h2>ç¬¬ 4 èª²ï¼šPWM åŸç†èˆ‡å–®é¦¬é”é€Ÿåº¦æ§åˆ¶ <span class="duration text-sm font-normal text-gray-500">(3H)</span></h2></div>
                <div class="lesson-body"><div class="lesson-icon" title="Motor Icon">ğŸ”‹</div><span class="phase-tag self-start">II. æ ¸å¿ƒé¦¬é”æ§åˆ¶</span><div class="core-content"><strong>æ ¸å¿ƒå…§å®¹ï¼š</strong><ul><li>H æ©‹é©…å‹•åŸç†ã€‚</li><li>PWM (è„ˆè¡å¯¬åº¦èª¿è®Š)ï¼šLEDC å‡½å¼ã€‚</li></ul></div><button id="action-btn-C2_L3" class="action-btn bg-gray-400 text-white" disabled>è¼‰å…¥ä¸­...</button></div>
            </div>
            <div class="lesson-card" id="lesson-C2_L5" data-course-id="r6muo2ss" data-course-name="è—ç‰™ä½åŠŸè€—ä¼ºæœå™¨ (BLE Server) å¯¦ä½œ" data-course-price="1500" data-classroom-url="https://classroom.google.com/c/ODE4Njg0OTQ0NjI0?cjc=r6muo2ss">
                <div class="lesson-header"><h2>ç¬¬ 5 èª²ï¼šè—ç‰™ä½åŠŸè€—ä¼ºæœå™¨ (BLE Server) å¯¦ä½œ <span class="duration text-sm font-normal text-gray-500">(3H)</span></h2></div>
                <div class="lesson-body"><div class="lesson-icon" title="BLE Server Icon">ğŸ“¡</div><span class="phase-tag self-start">III. é€šè¨Šèˆ‡å›é¥‹</span><div class="core-content"><strong>æ ¸å¿ƒå…§å®¹ï¼š</strong><ul><li>GATT å”å®šï¼šServiceã€Characteristicã€‚</li><li>æ•¸æ“šæ¥æ”¶ï¼šæ¥æ”¶æ‰‹æ©Ÿç«¯æ§åˆ¶æŒ‡ä»¤ã€‚</li></ul></div><button id="action-btn-C2_L5" class="action-btn bg-gray-400 text-white" disabled>è¼‰å…¥ä¸­...</button></div>
            </div>
            <div class="lesson-card" id="lesson-C1_L6" data-course-id="bee4arc4" data-course-name="æ–æ¡¿åº§æ¨™åˆ° API æŒ‡ä»¤çš„æ•¸å­¸è½‰æ›" data-course-price="1500" data-classroom-url="https://classroom.google.com/c/ODIxNzY4NDM1NzU0?cjc=bee4arc4">
                <div class="lesson-header"><h2>ç¬¬ 6 èª²ï¼šæ–æ¡¿åº§æ¨™åˆ° API æŒ‡ä»¤çš„æ•¸å­¸è½‰æ› <span class="duration text-sm font-normal text-gray-500">(3H)</span></h2></div>
                <div class="lesson-body"><div class="lesson-icon" title="Math Icon">ğŸ”¢</div><span class="phase-tag self-start">III. è™›æ“¬æ–æ¡¿èˆ‡ç²¾ç´°åŒ–æ§åˆ¶</span><div class="core-content"><strong>æ ¸å¿ƒå…§å®¹ï¼š</strong><ul><li>ç·šæ€§æ˜ å°„åŸç†ï¼šå°‡ç•«å¸ƒ X/Y åƒç´ ç¯„åœï¼Œè½‰æ›ç‚ºé€Ÿåº¦/è½‰å‘æ•¸å€¼ç¯„åœï¼ˆ0-255ï¼‰ã€‚</li><li>å·®é€Ÿæ•¸æ“šè¨ˆç®—ï¼šå»ºç«‹å°‡ X/Y åº§æ¨™è½‰æ›ç‚ºé€Ÿåº¦/è½‰å‘æŒ‡ä»¤ (CMD, F, V ç­‰) çš„ JS é‚è¼¯ã€‚</li></ul></div><button id="action-btn-C1_L6" class="action-btn bg-gray-400 text-white" disabled>è¼‰å…¥ä¸­...</button></div>
            </div>

            <div class="lesson-card" id="lesson-C1_L7" data-course-id="ks3fg46c" data-course-name="å®šæ™‚å™¨èˆ‡é€£çºŒæ•¸æ“šç™¼é€" data-course-price="1500" data-classroom-url="https://classroom.google.com/c/ODM2NzU4NzczMDc3?cjc=ks3fg46c">
                <div class="lesson-header"><h2>ç¬¬ 7 èª²ï¼šå®šæ™‚å™¨èˆ‡é€£çºŒæ•¸æ“šç™¼é€ <span class="duration text-sm font-normal text-gray-500">(3H)</span></h2></div>
                <div class="lesson-body"><div class="lesson-icon" title="Timer Icon">â±ï¸</div><span class="phase-tag self-start">III. è™›æ“¬æ–æ¡¿èˆ‡ç²¾ç´°åŒ–æ§åˆ¶</span><div class="core-content"><strong>æ ¸å¿ƒå…§å®¹ï¼š</strong><ul><li>ä»‹ç´¹ `setInterval` èˆ‡ `requestAnimationFrame` åœ¨å³æ™‚æ§åˆ¶ä¸­çš„ä½œç”¨ã€‚</li><li>è¨­å®š `setInterval` (å¦‚ 50ms é–“éš”)ï¼Œé€±æœŸæ€§å‘¼å«æ–æ¡¿æ•¸æ“šç™¼é€ç¨‹åºã€‚</li></ul></div><button id="action-btn-C1_L7" class="action-btn bg-gray-400 text-white" disabled>è¼‰å…¥ä¸­...</button></div>
            </div>

            <div class="lesson-card" id="lesson-C1_L8" data-course-id="r7cnaf4t" data-course-name="Wi-Fi (HTTP) é€šè¨Šèˆ‡ Fetch API" data-course-price="1500" data-classroom-url="https://classroom.google.com/c/ODM2NzU2NjA4NjMx?cjc=r7cnaf4t">
                <div class="lesson-header"><h2>ç¬¬ 8 èª²ï¼šWi-Fi (HTTP) é€šè¨Šèˆ‡ Fetch API <span class="duration text-sm font-normal text-gray-500">(3H)</span></h2></div>
                <div class="lesson-body"><div class="lesson-icon" title="WiFi Icon">ğŸ“¶</div><span class="phase-tag self-start">IV. Wi-Fi é€šè¨Šèˆ‡é›™æ¨¡å¼æ•´åˆ</span><div class="core-content"><strong>æ ¸å¿ƒå…§å®¹ï¼š</strong><ul><li>ä»‹ç´¹ç¾ä»£ JS çš„ `fetch` ç”¨æ–¼ç™¼é€ HTTP è«‹æ±‚ã€‚</li><li>å¯¦ä½œ Wi-Fi æ¨¡å¼ä¸‹çš„æ¸¬è©¦æŒ‰éˆ•ï¼Œç™¼é€ HTTP è«‹æ±‚æ§åˆ¶ä¸»æ§æ¿ã€‚</li></ul></div><button id="action-btn-C1_L8" class="action-btn bg-gray-400 text-white" disabled>è¼‰å…¥ä¸­...</button></div>
            </div>

            <div class="lesson-card" id="lesson-C2_L8" data-course-id="e4zfhzx6" data-course-name="Wi-Fi (AP) æ¨¡å¼èˆ‡ HTTP Web Server" data-course-price="1500" data-classroom-url="https://classroom.google.com/c/ODM2Nzk1ODk4Njcw?cjc=e4zfhzx6">
                <div class="lesson-header"><h2>ç¬¬ 9 èª²ï¼šWi-Fi (AP) æ¨¡å¼èˆ‡ HTTP Web Server <span class="duration text-sm font-normal text-gray-500">(3H)</span></h2></div>
                <div class="lesson-body"><div class="lesson-icon" title="Web Server Icon">ğŸŒ</div><span class="phase-tag self-start">IV. é€²éšæ§åˆ¶èˆ‡ç©©å®šæ€§</span><div class="core-content"><strong>æ ¸å¿ƒå…§å®¹ï¼š</strong><ul><li>ESP32 Wi-Fi æ¨¡å¼ï¼šè¨­å®šç‚º SoftAP æ¨¡å¼ã€‚</li><li>Web Serverï¼šå»ºç«‹è¼•é‡ç´š HTTP ä¼ºæœå™¨ã€‚</li></ul></div><button id="action-btn-C2_L8" class="action-btn bg-gray-400 text-white" disabled>è¼‰å…¥ä¸­...</button></div>
            </div>

            <div class="lesson-card" id="lesson-C1_L9" data-course-id="wlilo4dc" data-course-name="é›™æ¨¡å¼é™æ§å™¨è¨­è¨ˆèˆ‡ç‹€æ…‹åˆ‡æ›" data-course-price="1500" data-classroom-url="https://classroom.google.com/c/ODM2NzU4NzI3MDY5?cjc=wlilo4dc">
                <div class="lesson-header"><h2>ç¬¬ 10 èª²ï¼šé›™æ¨¡å¼é™æ§å™¨è¨­è¨ˆèˆ‡ç‹€æ…‹åˆ‡æ› <span class="duration text-sm font-normal text-gray-500">(3H)</span></h2></div>
                <div class="lesson-body"><div class="lesson-icon" title="Toggle Icon">ğŸ”„</div><span class="phase-tag self-start">IV. Wi-Fi é€šè¨Šèˆ‡é›™æ¨¡å¼æ•´åˆ</span><div class="core-content"><strong>æ ¸å¿ƒå…§å®¹ï¼š</strong><ul><li>è¨­è¨ˆä¸€å€‹å¯åˆ‡æ›çš„ç•Œé¢ï¼Œå®¹ç´ BLE é€£ç·šå’Œ Wi-Fi è¨­å®š (IP è¼¸å…¥)ã€‚</li><li>å¯¦ä½œæ ¹æ“šç•¶å‰æ¨¡å¼ï¼Œæ§åˆ¶æŒ‡ä»¤é€é BLE æˆ– Wi-Fi ç™¼é€çš„é‚è¼¯ã€‚</li></ul></div><button id="action-btn-C1_L9" class="action-btn bg-gray-400 text-white" disabled>è¼‰å…¥ä¸­...</button></div>
            </div>

        </div>
    </div>

    <footer class="bg-gray-800 py-8 border-t border-gray-700 mt-10">
        <div class="container mx-auto px-4 text-center">
            <div class="flex justify-center space-x-6 mb-6 text-gray-400">
                <a href="prepare.html" class="hover:text-white">èª²å‰æº–å‚™</a>
                <a href="started.html" class="hover:text-white">å…¥é–€èª²ç¨‹</a>
                <a href="basic.html" class="hover:text-white">åŸºç¤å¯¦ä½œ</a>
                <a href="advanced.html" class="hover:text-white">é€²éšæ‡‰ç”¨</a>
                <a href="about.html" class="hover:text-white">é—œæ–¼æˆ‘å€‘</a>
            </div>
            
            <div class="border-t border-gray-700 pt-6">
                <p class="text-gray-500 text-sm mb-2">&copy; 2025 Vibe Coding. All rights reserved.</p>
                <div class="flex flex-col md:flex-row justify-center items-center gap-2 md:gap-6 text-sm text-gray-400">
                    <span>ç‡Ÿæ¥­äººåç¨±ï¼šæ–‡ç¶“å‡ºç‰ˆç¤¾æœ‰é™å…¬å¸</span>
                    <span class="hidden md:inline">|</span>
                    <span>çµ±ä¸€ç·¨è™Ÿï¼š12376121</span>
                    <span class="hidden md:inline">|</span>
                    <span>èª²ç¨‹åˆä½œæ´½è«‡ï¼šinfo@vibe-coding.tw</span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        const btn = document.getElementById('mobile-menu-btn');
        const menu = document.getElementById('mobile-menu');
        btn.addEventListener('click', () => {
            menu.classList.toggle('hidden');
        });
        
        function renderLessons(lessons) {
            const container = document.getElementById('lesson-container'); // å‡è¨­æœ‰ä¸€å€‹å®¹å™¨
            container.className = "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6";

            const html = lessons.map(lesson => {
                // 1. è™•ç†æ ¸å¿ƒå…§å®¹åˆ—è¡¨ (li)
                const contentListHtml = lesson.coreContent
                    .map(item => `<li>${item}</li>`)
                    .join('');

                // 2. åˆ¤æ–·æ˜¯å¦æœ‰å½±ç‰‡ IDï¼Œæœ‰çš„è©±é¡¯ç¤ºé è¦½æŒ‰éˆ•ï¼Œæ²’æœ‰å‰‡ä¸é¡¯ç¤º
                const videoButtonHtml = lesson.videoId ? `
                    <button onclick="playFullScreenVideo('${lesson.videoId}')" 
                        class="flex-1 py-2 px-3 rounded-md border border-red-500 text-red-600 font-medium hover:bg-red-50 transition-colors flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/></svg>
                        èª²ç¨‹é è¦½
                    </button>` : '';

                // 3. èª¿æ•´æŒ‰éˆ•å¯¬åº¦æ¨£å¼ (å¦‚æœæ²’æœ‰å½±ç‰‡æŒ‰éˆ•ï¼Œè¼‰å…¥æŒ‰éˆ•æ‡‰è©²è¦æ˜¯ w-fullï¼Œå¦å‰‡å¯ä»¥æ˜¯ flex-1)
                const loadButtonClass = lesson.videoId ? 'flex-1' : 'w-full';

                return `
                    <div class="lesson-card w-full border border-gray-200 rounded-lg shadow-lg bg-white p-5 flex flex-col"
                         id="${lesson.id}" 
                         data-course-id="${lesson.courseId}" 
                         data-course-name="${lesson.title}" 
                         data-course-price="${lesson.price}" 
                         data-classroom-url="${lesson.classroomUrl}">
                
                        <div class="lesson-header mb-4 border-b pb-3">
                            <h2 class="text-xl font-bold text-gray-800 flex justify-between items-start gap-2">
                                <span>${lesson.lessonLabel}ï¼š${lesson.title}</span>
                                <span class="shrink-0 text-sm font-medium text-gray-500 bg-gray-100 px-2 py-1 rounded">(${lesson.duration})</span>
                            </h2>
                        </div>

                        <div class="lesson-body space-y-4">
                            <div class="flex items-center gap-3"> 
                                <div class="lesson-icon text-4xl bg-blue-50 p-2 rounded-lg">${lesson.icon}</div>                        
                                <span class="phase-tag bg-indigo-100 text-indigo-700 text-xs font-bold px-2 py-1 rounded">
                                    ${lesson.tagText}
                                </span>
                            </div>

                            <div class="core-content text-sm text-gray-600">
                                <strong class="text-gray-900 block mb-1">æ ¸å¿ƒå…§å®¹ï¼š</strong>
                                <ul class="list-disc pl-4 space-y-1">
                                    ${contentListHtml}
                                </ul>
                            </div>
                    
                            <div class="flex gap-2 mt-4">
                                ${videoButtonHtml}
                                <button id="action-btn-${lesson.id}" class="${loadButtonClass} py-2 px-3 rounded-md bg-gray-300 text-gray-500 font-medium cursor-not-allowed" disabled>
                                    è¼‰å…¥ä¸­...
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
        }

        // ç”¨ä¾†è¨˜éŒ„æ˜¯å¦æ­£åœ¨ç›£è½å…¨è¢å¹•è®ŠåŒ–ï¼Œé¿å…é‡è¤‡ç¶å®š
        let isListenerAttached = false;

        function playFullScreenVideo(videoId) {
            const container = document.getElementById('video-overlay');
            container.style.display = 'block';

            // ã€é—œéµä¿®æ”¹ã€‘åœ¨æ’å…¥ iframe çš„åŒæ™‚ï¼Œä¹Ÿæ’å…¥ä¸€å€‹è‡ªè¨‚çš„é—œé–‰æŒ‰éˆ•
            container.innerHTML = `
                <button class="close-video-btn" onclick="forceCloseVideo()">
                    âœ• é—œé–‰å½±ç‰‡
                </button>
                <iframe 
                    id="yt-player-frame"
                    src="https://www.youtube.com/embed/${videoId}?autoplay=1&enablejsapi=1" 
                    title="YouTube video player" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                    allowfullscreen>
                </iframe>
            `;
            
            const iframe = document.getElementById('yt-player-frame');

            // è«‹æ±‚å…¨è¢å¹•
            if (iframe.requestFullscreen) {
                iframe.requestFullscreen();
            } else if (iframe.webkitRequestFullscreen) { 
                iframe.webkitRequestFullscreen();
            } else if (iframe.msRequestFullscreen) { 
                iframe.msRequestFullscreen();
            }

            // ç¶å®šã€Œç‰©ç†ã€å…¨è¢å¹•è®ŠåŒ–ç›£è½ (ä¾‹å¦‚æŒ‰ Esc æˆ–æ‰‹æ©Ÿè¿”å›éµ)
            if (!isListenerAttached) {
                document.addEventListener('fullscreenchange', checkFullscreenStatus);
                document.addEventListener('webkitfullscreenchange', checkFullscreenStatus);
                document.addEventListener('mozfullscreenchange', checkFullscreenStatus);
                document.addEventListener('MSFullscreenChange', checkFullscreenStatus);
                isListenerAttached = true;
            }
        }

        // ç•¶æŒ‰ä¸‹ç•«é¢ä¸Šé‚£å€‹ã€ŒX é—œé–‰å½±ç‰‡ã€æŒ‰éˆ•æ™‚è§¸ç™¼
        function forceCloseVideo() {
            // å˜—è©¦é€é API é€€å‡ºå…¨è¢å¹•
            if (document.exitFullscreen) {
                document.exitFullscreen().catch(err => {
                    // å¦‚æœå› ç‚ºæŸäº›åŸå› å¤±æ•— (ä¾‹å¦‚å·²ç¶“ä¸æ˜¯å…¨è¢å¹•æ¨¡å¼)ï¼Œç›´æ¥åŸ·è¡Œæ¸…ç†
                    cleanupVideo();
                });
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else {
                // å¦‚æœç€è¦½å™¨ä¸æ”¯æ´æ¨™æº– APIï¼Œç›´æ¥æ¸…ç†
                cleanupVideo();
            }
        }

        // ç›£è½å™¨ï¼šæª¢æŸ¥æ˜¯å¦å·²ç¶“é€€å‡ºå…¨è¢å¹•
        function checkFullscreenStatus() {
            if (!document.fullscreenElement && 
                !document.webkitIsFullScreen && 
                !document.mozFullScreen && 
                !document.msFullscreenElement) {
                cleanupVideo();
            }
        }

        // æ¸…ç†ç•«é¢ï¼šéš±è—å®¹å™¨ã€ç§»é™¤ iframe
        function cleanupVideo() {
            const container = document.getElementById('video-overlay');
            container.innerHTML = ''; // æ¸…ç©ºå…§å®¹ (é‡è¦ï¼é€™æ¨£è²éŸ³æ‰æœƒåœ)
            container.style.display = 'none';
        }
    </script>

    <script type="module">

        // 1. åŒ¯å…¥å¿…è¦çš„ Firebase å‡½å¼
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js"; 
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
        import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-functions.js";

        // 2. Firebase é…ç½®
        const firebaseConfig = {
          apiKey: "AIzaSyCO6Y6Pa7b7zbieJIErysaNF6-UqbT8KJw",
          authDomain: "e-learning-942f7.firebaseapp.com",
          projectId: "e-learning-942f7",
          storageBucket: "e-learning-942f7.firebasestorage.app",
          messagingSenderId: "878397058574",
          appId: "1:878397058574:web:28aaa07a291ee3baab165f"
        };

        // 3. åˆå§‹åŒ– Firebase æœå‹™
        const app = initializeApp(firebaseConfig);        
        const auth = getAuth(app);           
        const functions = getFunctions(app, 'asia-east1');         
        const checkAuthFunction = httpsCallable(functions, 'checkPaymentAuthorization');
        const CART_URL = 'cart.html'; 
        const AUTH_URL = 'auth.html'; 

        // ===============================================
        // A. è³¼ç‰©è»Šæ ¸å¿ƒé‚è¼¯ (åƒ…è™•ç†å­˜å„²ï¼Œç„¡æç¤º/è·³è½‰)
        // ===============================================
        function addToCart(productId, productName, productPrice) {
            let cart = JSON.parse(localStorage.getItem('vibeCodingCart') || '{}');
            const priceNum = parseInt(productPrice, 10);
            
            // æª¢æŸ¥å•†å“æ˜¯å¦å·²å­˜åœ¨
            if (cart[productId]) {
                return { success: false, message: `ã€Œ${productName}ã€å·²åœ¨è³¼ç‰©è»Šä¸­ï¼` };
            }
            
            // å°‡å•†å“åŠ å…¥è³¼ç‰©è»Š
            cart[productId] = { 
                name: productName, 
                price: priceNum, 
                quantity: 1 
            };
            localStorage.setItem('vibeCodingCart', JSON.stringify(cart));
            
            return { success: true, message: `ã€Œ${productName}ã€å·²æˆåŠŸåŠ å…¥è³¼ç‰©è»Šï¼` };
        }


        // ===============================================
        // B. è³¼ç‰©è»Šç¢ºèªæµç¨‹ (èˆ‡ basic.html ä¿æŒä¸€è‡´)
        // ===============================================
        function handleAddToCartConfirmation(courseId, courseName, coursePrice) {
            const cart = JSON.parse(localStorage.getItem('vibeCodingCart') || '{}');
            
            // 1. é å…ˆæª¢æŸ¥è³¼ç‰©è»Šï¼Œå¦‚æœå·²å­˜åœ¨ï¼Œåªå½ˆå‡º alert æé†’
            if (cart[courseId]) {
                alert(`âš ï¸ ã€Œ${courseName}ã€å·²åœ¨è³¼ç‰©è»Šä¸­ï¼`);
                return; // çµæŸå‡½å¼ï¼Œåœç•™åœ¨åŸé é¢
            }
            
            // 2. åªæœ‰ç•¶å•†å“ä¸å­˜åœ¨æ™‚ï¼Œæ‰åŸ·è¡Œ confirm æ­¥é©Ÿ
            const priceText = `NT$ ${parseInt(coursePrice, 10).toLocaleString()}`;
            
            const isConfirmed = confirm(`æ‚¨ç¢ºå®šè¦å°‡èª²ç¨‹ã€Œ${courseName}ã€åŠ å…¥è³¼ç‰©è»Šå—ï¼Ÿ\n\nåƒ¹æ ¼ï¼š${priceText}`);

            if (isConfirmed) {
                // å¦‚æœä½¿ç”¨è€…æŒ‰ä¸‹ã€Œç¢ºå®šã€
                const result = addToCart(courseId, courseName, coursePrice);
                alert(`ğŸ›’ ã€Œ${courseName}ã€å·²åŠ å…¥è³¼ç‰©è»Šï¼Œè«‹å‰å¾€çµå¸³é é¢ï¼`); 
                window.location.href = CART_URL; // ä¿æŒ basic.html çš„è¡Œç‚º (å¦‚æœå•†å“æ˜¯æ”¶è²»çš„)
            } 
        }

        // ===============================================
        // C. ç™»å…¥/ç™»å‡ºé‚è¼¯ (ä¸è®Š)
        // ===============================================
        async function handleLogin() {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                console.error("ç™»å…¥å¤±æ•—:", error);
            }
        }

        async function handleLogout() {
            await signOut(auth);
        }

        // ===============================================
        // D. å‹•æ…‹æŒ‰éˆ•ç‹€æ…‹æ›´æ–°æ ¸å¿ƒé‚è¼¯
        // ===============================================
        
        const lessonCards = document.querySelectorAll('.lesson-card');

        /**
         * æ ¹æ“šæˆæ¬Šç‹€æ…‹æ›´æ–°å–®ä¸€èª²ç¨‹å¡ç‰‡çš„æŒ‰éˆ•
         */
        function updateCardAction(cardElement, status) {
            const btn = cardElement.querySelector('.action-btn');
            const courseId = cardElement.dataset.courseId;
            const courseName = cardElement.dataset.courseName;
            const coursePrice = cardElement.dataset.coursePrice; // é—œéµï¼šåƒ¹æ ¼åƒæ•¸
            const classroomUrl = cardElement.dataset.classroomUrl;
            const isFreeCourse = parseInt(coursePrice, 10) === 0; 
            const priceText = `NT$ ${parseInt(coursePrice, 10).toLocaleString()}`; 

            // æ¸…é™¤æ‰€æœ‰èˆŠçš„äº‹ä»¶ç›£è½å™¨
            btn.onclick = null; 
            btn.disabled = false;

            if (status === 'AUTHORIZED') {
                // ç‹€æ…‹ 1: å·²æˆæ¬Š -> é€²å…¥èª²ç¨‹
                btn.textContent = 'âœ… é€²å…¥èª²ç¨‹å…§å®¹';
                btn.className = 'action-btn bg-green-600 hover:bg-green-700 text-white';
                btn.onclick = () => {
                    // å‚³é courseId å’Œ coursePrice çµ¦ auth.html 
                    window.location.href = `${AUTH_URL}?url=${encodeURIComponent(classroomUrl)}&id=${courseId}&price=${coursePrice}`;
                };
            } else if (status === 'UNAUTHORIZED') {
                // ç‹€æ…‹ 2: å·²ç™»å…¥ä½†æœªè³¼è²· (ä¸»è¦é‡å°æ”¶è²»èª²ç¨‹)
                
                if (isFreeCourse) {
                    // å…è²»èª²ç¨‹å‡ºç¾ UNAUTHORIZED è¦–ç‚ºç•°å¸¸
                    btn.textContent = 'â›” æˆæ¬ŠéŒ¯èª¤ (è«‹è¯ç¹«å®¢æœ)';
                    btn.className = 'action-btn bg-red-600 hover:bg-red-700 text-white';
                    btn.onclick = () => window.location.reload(); 
                } else {
                    // æ”¶è²»èª²ç¨‹ï¼šå¼•å°åŠ å…¥è³¼ç‰©è»Š (é»æ“Šå¾Œé€²å…¥ç¢ºèªæµç¨‹)
                    btn.textContent = `ğŸ›’ åŠ å…¥è³¼ç‰©è»Š (${priceText})`;
                    btn.className = 'action-btn bg-indigo-600 hover:bg-indigo-700 text-white';
                    btn.onclick = () => {
                        handleAddToCartConfirmation(courseId, courseName, coursePrice); 
                    };
                }
            } else if (status === 'NOT_LOGGED_IN') {
                // ç‹€æ…‹ 3: æœªç™»å…¥

                if (isFreeCourse) {
                    // å…è²»èª²ç¨‹ï¼šå¼•å°ç™»å…¥
                    btn.textContent = 'ğŸ‘¤ è«‹å…ˆç™»å…¥ä»¥é€²å…¥èª²ç¨‹ (å…è²»)';
                    btn.className = 'action-btn bg-indigo-600 hover:bg-indigo-700 text-white';
                    btn.onclick = handleLogin;
                } else {
                    // æ”¶è²»èª²ç¨‹ï¼šå¼•å°åŠ å…¥è³¼ç‰©è»Š (é»æ“Šå¾Œé€²å…¥ç¢ºèªæµç¨‹)
                    btn.textContent = `ğŸ›’ åŠ å…¥è³¼ç‰©è»Š (${priceText})`;
                    btn.className = 'action-btn bg-indigo-600 hover:bg-indigo-700 text-white';
                    btn.onclick = () => {
                        handleAddToCartConfirmation(courseId, courseName, coursePrice); 
                    };
                }

            } else if (status === 'LOADING') {
                // ç‹€æ…‹ 4: è¼‰å…¥ä¸­
                btn.textContent = 'æ¬Šé™æª¢æŸ¥ä¸­...';
                btn.className = 'action-btn bg-gray-400 text-white';
                btn.disabled = true;
            } else if (status === 'ERROR') {
                // éŒ¯èª¤ç‹€æ…‹ (æ”¶è²»èª²ç¨‹ CF æª¢æŸ¥å¤±æ•—ï¼Œå°å‘ UNAUTHORIZED æµç¨‹)
                
                if (isFreeCourse) {
                    // å…è²»èª²ç¨‹ï¼šèˆ‡ NOT_LOGGED_IN é‚è¼¯ç›¸åŒï¼Œå¼•å°ç™»å…¥
                    btn.textContent = 'ğŸ‘¤ è«‹å…ˆç™»å…¥ä»¥é€²å…¥èª²ç¨‹ (å…è²»)';
                    btn.className = 'action-btn bg-indigo-600 hover:bg-indigo-700 text-white';
                    btn.onclick = handleLogin;
                } else {
                    // æ”¶è²»èª²ç¨‹ï¼šå°å‘ UNAUTHORIZED (åŠ å…¥è³¼ç‰©è»Šç¢ºèª)
                    btn.textContent = `ğŸ›’ åŠ å…¥è³¼ç‰©è»Š (${priceText})`;
                    btn.className = 'action-btn bg-indigo-600 hover:bg-indigo-700 text-white';
                    btn.onclick = () => {
                        handleAddToCartConfirmation(courseId, courseName, coursePrice); 
                    };
                }
            }
        }

        /**
         * æª¢æŸ¥å–®ä¸€èª²ç¨‹çš„æˆæ¬Šç‹€æ…‹ (å„ªåŒ–ï¼šå…è²»èª²ç¨‹è·³é Cloud Function)
         */
        async function checkLessonAuthorization(cardElement, user) {
            updateCardAction(cardElement, 'LOADING');

            const courseId = cardElement.dataset.courseId;
            const classroomUrl = cardElement.dataset.classroomUrl;
            const isFreeCourse = parseInt(cardElement.dataset.coursePrice, 10) === 0;

            // ğŸ’¥ ä¿®æ­£ï¼šå…è²»èª²ç¨‹ä¸”ä½¿ç”¨è€…å·²ç™»å…¥ï¼Œç›´æ¥è¦–ç‚º AUTHORIZED (è·³é CF)
            if (isFreeCourse && user) {
                updateCardAction(cardElement, 'AUTHORIZED');
                return; 
            }
            
            // ğŸ’¥ ä¿®æ­£ï¼šå¦‚æœæœªç™»å…¥ï¼Œä¸éœ€è¦å‘¼å« CFï¼Œç›´æ¥å°å‘ NOT_LOGGED_IN
            if (!user) {
                updateCardAction(cardElement, 'NOT_LOGGED_IN');
                return;
            }

            // --- æ”¶è²»èª²ç¨‹æ‰æœƒèµ°åˆ°é€™è£¡ (å‘¼å« CF) ---
            try {
                const result = await checkAuthFunction({ 
                    courseId: courseId, 
                    targetUrl: encodeURIComponent(classroomUrl) 
                });

                const status = result.data.status; 
                updateCardAction(cardElement, status);

            } catch (error) {
                console.error(`èª²ç¨‹ ${courseId} æˆæ¬Šæª¢æŸ¥å¤±æ•—:`, error);
                
                // CF å‘¼å«å¤±æ•—ï¼Œæ”¶è²»èª²ç¨‹å°å‘ UNAUTHORIZED (åŠ å…¥è³¼ç‰©è»Š)
                updateCardAction(cardElement, 'UNAUTHORIZED');
            }
        }

        // ----------------------------------------------------
        // E. ç¸½é«”æˆæ¬Šæµç¨‹æ§åˆ¶å™¨ 
        // ----------------------------------------------------
        onAuthStateChanged(auth, (user) => {
            const userDisplay = document.getElementById('user-display');
            const loginBtn = document.getElementById('login-btn');

            if (user) {
                userDisplay.textContent = `æ‚¨å¥½, ${user.displayName || user.email}`;
                userDisplay.classList.remove('hidden'); // ç¢ºä¿é¡¯ç¤º
                loginBtn.textContent = 'ç™»å‡º';
                loginBtn.onclick = handleLogout;
                
                lessonCards.forEach(card => {
                    checkLessonAuthorization(card, user);
                });
            } else {
                userDisplay.textContent = 'è¨ªå®¢';
                userDisplay.classList.add('hidden'); // æ‰‹æ©Ÿç‰ˆéš±è—è¨ªå®¢æ–‡å­—
                userDisplay.classList.remove('md:inline'); // é›»è…¦ç‰ˆé¡¯ç¤º
                loginBtn.textContent = 'ç™»å…¥';
                loginBtn.onclick = handleLogin;
                
                lessonCards.forEach(card => {
                    // ä¿®æ­£ï¼šæœªç™»å…¥æ™‚ï¼Œç›´æ¥è¨­å®šç‹€æ…‹ï¼Œè®“ updateCardAction è™•ç†å…è²»/æ”¶è²»èª²ç¨‹
                    updateCardAction(card, 'NOT_LOGGED_IN'); 
                });
            }
        });

    </script>
</body>
</html>