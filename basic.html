<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸºç¤èª²ç¨‹ï¼šé¦¬é”æ§åˆ¶ã€é€šè¨Šèˆ‡ OTA å¯¦ä½œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* åŸºç¤æ¨£å¼ (ä½¿ç”¨ Tailwind çš„ reset) */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f9; color: #333; }
        
        /* èª²ç¨‹ç¶²æ ¼èˆ‡å¡ç‰‡ */
        .lesson-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; }
        .lesson-card { 
            background-color: #fff; 
            border-radius: 12px; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); 
            transition: transform 0.3s ease, box-shadow 0.3s ease; 
            height: 100%; 
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .lesson-card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12); 
            background-color: #e9fff0; /* æ‡¸åœæ™‚ä½¿ç”¨æ·ºç¶ è‰²åé¥‹ */
        }
        .lesson-header { background-color: #e9fff0; padding: 15px 20px; border-bottom: 2px solid #28a745; }
        .lesson-header h2 { margin: 0; font-size: 1.25em; color: #28a745; }
        .lesson-body { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
        .lesson-icon { width: 50px; height: 50px; background-color: #28a745; color: #fff; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 2em; margin-bottom: 15px; }
        .phase-tag { display: inline-block; background-color: #6c757d; color: #fff; padding: 5px 10px; border-radius: 5px; font-size: 0.8em; margin-bottom: 10px; }
        .core-content { margin-top: 15px; font-size: 0.9em; color: #555; flex-grow: 1;}
        .core-content ul { list-style: disc; padding-left: 20px; margin: 5px 0 0 0; }
        .duration { font-style: italic; color: #666; margin-top: 5px; font-size: 0.9em; display: block; }
        
        /* å‹•æ…‹æŒ‰éˆ•æ¨£å¼ */
        .action-btn { 
            margin-top: 20px; 
            width: 100%; 
            padding: 10px; 
            border-radius: 6px; 
            font-weight: bold; 
            transition: background-color 0.2s;
            cursor: pointer;
        }
    </style>
</head>
<body class="p-5">
    <div class="container mx-auto">
        <header class="flex justify-between items-center py-4 px-0 border-b mb-6">
            <h1 class="text-3xl font-bold text-green-600">âš™ï¸ åŸºç¤èª²ç¨‹ï¼šé¦¬é”æ§åˆ¶ã€é€šè¨Šèˆ‡ OTA å¯¦ä½œ</h1>
            <div id="auth-status" class="text-sm">
                <span id="user-display" class="text-gray-600">è¨ªå®¢æ¨¡å¼</span>
                <button id="login-btn" class="ml-3 bg-indigo-500 hover:bg-indigo-600 text-white text-sm py-1 px-3 rounded">ç™»å…¥</button>
            </div>
        </header>

        <div class="lesson-grid">

            <div class="lesson-card" 
                 id="lesson-C2_L1" 
                 data-course-id="C2_L1" 
                 data-course-name="é–‹ç™¼ç’°å¢ƒè¨­å®šèˆ‡ç¡¬é«”å°è¦½" 
                 data-course-price="1290"
                 data-classroom-url="https://classroom.google.com/c/xxx...&lesson=L1">
                <div class="lesson-header">
                    <h2>ç¬¬ 1 èª²ï¼šé–‹ç™¼ç’°å¢ƒè¨­å®šèˆ‡ç¡¬é«”å°è¦½ <span class="duration">(3H)</span></h2>
                </div>
                <div class="lesson-body">
                    <div class="lesson-icon" title="Setup Icon">ğŸ–¥ï¸</div>
                    <span class="phase-tag">I. æº–å‚™èˆ‡åŸºç¤ I/O</span>
                    <div class="core-content">
                        <strong>æ ¸å¿ƒå…§å®¹ï¼š</strong>
                        <ul>
                            <li>è»Ÿé«”å®‰è£ï¼šVS Codeã€PlatformIO IDE å®‰è£èˆ‡è¨­å®šã€‚</li>
                            <li>ç¡¬é«”æ¦‚è§€ï¼šèªè­˜ ESP32ã€ç›´æµé¦¬é”ã€é©…å‹•æ¨¡çµ„ï¼ˆH æ©‹ï¼‰åŠè»Šé«”çµæ§‹ã€‚</li>
                            <li>PlatformIO å°ˆæ¡ˆçµæ§‹ï¼šå­¸ç¿’ `platformio.ini` é…ç½®èˆ‡æª”æ¡ˆçµ„ç¹”ã€‚</li>
                        </ul>
                    </div>
                    <button id="action-btn-C2_L1" class="action-btn bg-gray-400 text-white" disabled>
                        è¼‰å…¥ä¸­...
                    </button>
                </div>
            </div>

            <div class="lesson-card" 
                 id="lesson-C2_L2" 
                 data-course-id="C2_L2" 
                 data-course-name="C/C++ åŸºç¤èªæ³•èˆ‡æ•¸ä½é¡æ¯” I/O" 
                 data-course-price="1290"
                 data-classroom-url="https://classroom.google.com/c/xxx...&lesson=L2">
                <div class="lesson-header">
                    <h2>ç¬¬ 2 èª²ï¼šC/C++ åŸºç¤èªæ³•èˆ‡æ•¸ä½é¡æ¯” I/O <span class="duration">(3H)</span></h2>
                </div>
                <div class="lesson-body">
                    <div class="lesson-icon" title="Code Icon">ğŸ’»</div>
                    <span class="phase-tag">I. æº–å‚™èˆ‡åŸºç¤ I/O</span>
                    <div class="core-content">
                        <strong>æ ¸å¿ƒå…§å®¹ï¼š</strong>
                        <ul>
                            <li>Arduino æ¡†æ¶ï¼š`setup()` èˆ‡ `loop()` å‡½å¼ã€è³‡æ–™å‹åˆ¥ã€‚</li>
                            <li>æ•¸ä½ I/Oï¼š`pinMode()` èˆ‡ `digitalWrite()` æ‡‰ç”¨ï¼Œæ§åˆ¶ LED ç‡ˆã€‚</li>
                            <li>é¡æ¯” I/Oï¼š`analogRead()` æ‡‰ç”¨ï¼Œäº†è§£æ„Ÿæ¸¬å™¨æ•¸æ“šè®€å–ã€‚</li>
                        </ul>
                    </div>
                    <button id="action-btn-C2_L2" class="action-btn bg-gray-400 text-white" disabled>
                        è¼‰å…¥ä¸­...
                    </button>
                </div>
            </div>

            <div class="lesson-card" 
                 id="lesson-C2_L3" 
                 data-course-id="C2_L3" 
                 data-course-name="PWM åŸç†èˆ‡å–®é¦¬é”é€Ÿåº¦æ§åˆ¶" 
                 data-course-price="1290"
                 data-classroom-url="https://classroom.google.com/c/xxx...&lesson=L3">
                <div class="lesson-header">
                    <h2>ç¬¬ 3 èª²ï¼šPWM åŸç†èˆ‡å–®é¦¬é”é€Ÿåº¦æ§åˆ¶ <span class="duration">(3H)</span></h2>
                </div>
                <div class="lesson-body">
                    <div class="lesson-icon" title="Motor Icon">ğŸ”‹</div>
                    <span class="phase-tag">II. æ ¸å¿ƒé¦¬é”æ§åˆ¶</span>
                    <div class="core-content">
                        <strong>æ ¸å¿ƒå…§å®¹ï¼š</strong>
                        <ul>
                            <li>H æ©‹é©…å‹•åŸç†ï¼šå­¸ç¿’é¦¬é”æ­£è½‰ã€åè½‰èˆ‡ç…è»Šé‚è¼¯ã€‚</li>
                            <li>PWM (è„ˆè¡å¯¬åº¦èª¿è®Š)ï¼šä»‹ç´¹ ESP32 çš„ PWM (LEDC) å‡½å¼ã€‚</li>
                            <li>å¯¦ä½œï¼šä½¿ç”¨ PWM èª¿æ•´å–®ä¸€é¦¬é”é€Ÿåº¦ã€‚</li>
                        </ul>
                    </div>
                    <button id="action-btn-C2_L3" class="action-btn bg-gray-400 text-white" disabled>
                        è¼‰å…¥ä¸­...
                    </button>
                </div>
            </div>

            <div class="lesson-card" 
                 id="lesson-C2_L4" 
                 data-course-id="C2_L4" 
                 data-course-name="å·®é€Ÿé©…å‹•åŸç†èˆ‡é‹å‹• API å¯¦ç¾" 
                 data-course-price="1290"
                 data-classroom-url="https://classroom.google.com/c/xxx...&lesson=L4">
                <div class="lesson-header">
                    <h2>ç¬¬ 4 èª²ï¼šå·®é€Ÿé©…å‹•åŸç†èˆ‡é‹å‹• API å¯¦ç¾ <span class="duration">(3H)</span></h2>
                </div>
                <div class="lesson-body">
                    <div class="lesson-icon" title="API Icon">ğŸš—</div>
                    <span class="phase-tag">II. æ ¸å¿ƒé¦¬é”æ§åˆ¶</span>
                    <div class="core-content">
                        <strong>æ ¸å¿ƒå…§å®¹ï¼š</strong>
                        <ul>
                            <li>å·®é€Ÿé©…å‹•ï¼šè¬›è§£è»Šè¼›è½‰å‘çš„åŸç†ï¼ˆå·¦å³é¦¬é”é€Ÿåº¦å·®ç•°ï¼‰ã€‚</li>
                            <li>åŸºç¤ API è¨­è¨ˆï¼šå¯¦ç¾ CMD, F, V (å‰é€²)ã€CMD, R, V (å³è½‰) ç­‰æŒ‡ä»¤çš„è§£æé‚è¼¯ã€‚</li>
                            <li>å¯¦ä½œï¼šæ’°å¯«çµ±ä¸€çš„é¦¬é”æ§åˆ¶å‡½å¼ï¼ŒåŸ·è¡Œè¤‡é›œé‹å‹•ã€‚</li>
                        </ul>
                    </div>
                    <button id="action-btn-C2_L4" class="action-btn bg-gray-400 text-white" disabled>
                        è¼‰å…¥ä¸­...
                    </button>
                </div>
            </div>

            <div class="lesson-card" 
                 id="lesson-C2_L5" 
                 data-course-id="C2_L5" 
                 data-course-name="è—ç‰™ä½åŠŸè€—ä¼ºæœå™¨ (BLE Server) å¯¦ä½œ" 
                 data-course-price="1290"
                 data-classroom-url="https://classroom.google.com/c/xxx...&lesson=L5">
                <div class="lesson-header">
                    <h2>ç¬¬ 5 èª²ï¼šè—ç‰™ä½åŠŸè€—ä¼ºæœå™¨ (BLE Server) å¯¦ä½œ <span class="duration">(3H)</span></h2>
                </div>
                <div class="lesson-body">
                    <div class="lesson-icon" title="BLE Server Icon">ğŸ“¡</div>
                    <span class="phase-tag">III. é€šè¨Šèˆ‡å›é¥‹</span>
                    <div class="core-content">
                        <strong>æ ¸å¿ƒå…§å®¹ï¼š</strong>
                        <ul>
                            <li>GATT å”å®šï¼šè¬›è§£ Serviceã€Characteristic èˆ‡ Descriptor æ¦‚å¿µã€‚</li>
                            <li>BLE ä¼ºæœå™¨å»ºæ§‹ï¼šä½¿ç”¨ ESP32 BLE å‡½å¼åº«ï¼Œå»ºç«‹æœå‹™èˆ‡ç‰¹æ€§å€¼ã€‚</li>
                            <li>æ•¸æ“šæ¥æ”¶ï¼šå¯¦ä½œ `onWrite` å›å‘¼å‡½å¼ï¼Œæ¥æ”¶æ‰‹æ©Ÿç«¯ç™¼ä¾†çš„æ§åˆ¶æŒ‡ä»¤å­—ä¸²ã€‚</li>
                        </ul>
                    </div>
                    <button id="action-btn-C2_L5" class="action-btn bg-gray-400 text-white" disabled>
                        è¼‰å…¥ä¸­...
                    </button>
                </div>
            </div>

            <div class="lesson-card" 
                 id="lesson-C2_L6" 
                 data-course-id="C2_L6" 
                 data-course-name="å…‰é›»ç·¨ç¢¼å™¨èˆ‡é€Ÿåº¦å³æ™‚å›é¥‹" 
                 data-course-price="1290"
                 data-classroom-url="https://classroom.google.com/c/xxx...&lesson=L6">
                <div class="lesson-header">
                    <h2>ç¬¬ 6 èª²ï¼šå…‰é›»ç·¨ç¢¼å™¨èˆ‡é€Ÿåº¦å³æ™‚å›é¥‹ <span class="duration">(3H)</span></h2>
                </div>
                <div class="lesson-body">
                    <div class="lesson-icon" title="Feedback Icon">ğŸ”„</div>
                    <span class="phase-tag">III. é€šè¨Šèˆ‡å›é¥‹</span>
                    <div class="core-content">
                        <strong>æ ¸å¿ƒå…§å®¹ï¼š</strong>
                        <ul>
                            <li>ç·¨ç¢¼å™¨åŸç†ï¼šäº†è§£å…‰é›»ç·¨ç¢¼å™¨å¦‚ä½•è¼¸å‡ºè„ˆè¡è¨Šè™Ÿã€‚</li>
                            <li>ä¸­æ–· (Interrupts)ï¼šå­¸ç¿’ä½¿ç”¨ä¸­æ–·ä¾†ç²¾ç¢ºè¨ˆæ•¸ç·¨ç¢¼å™¨çš„è„ˆè¡ã€‚</li>
                            <li>å¯¦ä½œï¼šè®€å–é¦¬é”è„ˆè¡æ•¸ï¼Œè¨ˆç®—ç•¶å‰è¼ªå­çš„ RPM æˆ–ç·šé€Ÿåº¦ã€‚</li>
                        </ul>
                    </div>
                    <button id="action-btn-C2_L6" class="action-btn bg-gray-400 text-white" disabled>
                        è¼‰å…¥ä¸­...
                    </button>
                </div>
            </div>

            <div class="lesson-card" 
                 id="lesson-C2_L7" 
                 data-course-id="C2_L7" 
                 data-course-name="PID é–‰è¿´è·¯æ§åˆ¶åŸºç¤ (é€Ÿåº¦ç©©å®š)" 
                 data-course-price="1290"
                 data-classroom-url="https://classroom.google.com/c/xxx...&lesson=L7">
                <div class="lesson-header">
                    <h2>ç¬¬ 7 èª²ï¼šPID é–‰è¿´è·¯æ§åˆ¶åŸºç¤ (é€Ÿåº¦ç©©å®š) <span class="duration">(3H)</span></h2>
                </div>
                <div class="lesson-body">
                    <div class="lesson-icon" title="PID Icon">ğŸ”¬</div>
                    <span class="phase-tag">IV. é€²éšæ§åˆ¶èˆ‡ç©©å®šæ€§</span>
                    <div class="core-content">
                        <strong>æ ¸å¿ƒå…§å®¹ï¼š</strong>
                        <ul>
                            <li>é–‰è¿´è·¯æ¦‚å¿µï¼šå€åˆ†é–‹è¿´è·¯èˆ‡é–‰è¿´è·¯æ§åˆ¶ã€‚</li>
                            <li>PID ç†è«–ï¼šè¬›è§£æ¯”ä¾‹ (P)ã€ç©åˆ† (I)ã€å¾®åˆ† (D) ä¸‰é …çš„æ„ç¾©èˆ‡ä½œç”¨ã€‚</li>
                            <li>å¯¦ä½œï¼šæ’°å¯« PID å‡½å¼ï¼Œæ‡‰ç”¨æ–¼é¦¬é”å®šé€Ÿè¡Œé§›ã€‚</li>
                        </ul>
                    </div>
                    <button id="action-btn-C2_L7" class="action-btn bg-gray-400 text-white" disabled>
                        è¼‰å…¥ä¸­...
                    </button>
                </div>
            </div>

            <div class="lesson-card" 
                 id="lesson-C2_L8" 
                 data-course-id="C2_L8" 
                 data-course-name="Wi-Fi (AP) æ¨¡å¼èˆ‡ HTTP Web Server" 
                 data-course-price="1290"
                 data-classroom-url="https://classroom.google.com/c/xxx...&lesson=L8">
                <div class="lesson-header">
                    <h2>ç¬¬ 8 èª²ï¼šWi-Fi (AP) æ¨¡å¼èˆ‡ HTTP Web Server <span class="duration">(3H)</span></h2>
                </div>
                <div class="lesson-body">
                    <div class="lesson-icon" title="Web Server Icon">ğŸŒ</div>
                    <span class="phase-tag">IV. é€²éšæ§åˆ¶èˆ‡ç©©å®šæ€§</span>
                    <div class="core-content">
                        <strong>æ ¸å¿ƒå…§å®¹ï¼š</strong>
                        <ul>
                            <li>ESP32 Wi-Fi æ¨¡å¼ï¼šè¨­å®šç‚º SoftAP æ¨¡å¼ï¼Œå»ºç«‹å°ˆå±¬ç†±é»ã€‚</li>
                            <li>Web Serverï¼šå»ºç«‹è¼•é‡ç´š HTTP ä¼ºæœå™¨ï¼Œä¸¦è™•ç† GET è«‹æ±‚ã€‚</li>
                            <li>å¯¦ä½œï¼šè¨­è¨ˆ `/control?cmd=X&val=Y` æ ¼å¼çš„ URL æ¥å£ï¼Œè®“ç€è¦½å™¨ç™¼é€é‹å‹•æŒ‡ä»¤ã€‚</li>
                        </ul>
                    </div>
                    <button id="action-btn-C2_L8" class="action-btn bg-gray-400 text-white" disabled>
                        è¼‰å…¥ä¸­...
                    </button>
                </div>
            </div>

            <div class="lesson-card" 
                 id="lesson-C2_L9" 
                 data-course-id="C2_L9" 
                 data-course-name="OTA ç„¡ç·šæ›´æ–°æ¶æ§‹èˆ‡å¯¦å‹™" 
                 data-course-price="1290"
                 data-classroom-url="https://classroom.google.com/c/xxx...&lesson=L9">
                <div class="lesson-header">
                    <h2>ç¬¬ 9 èª²ï¼šOTA ç„¡ç·šæ›´æ–°æ¶æ§‹èˆ‡å¯¦å‹™ <span class="duration">(3H)</span></h2>
                </div>
                <div class="lesson-body">
                    <div class="lesson-icon" title="Update Icon">â¬†ï¸</div>
                    <span class="phase-tag">V. éŸŒé«”æ¶æ§‹èˆ‡ç¶­è­·</span>
                    <div class="core-content">
                        <strong>æ ¸å¿ƒå…§å®¹ï¼š</strong>
                        <ul>
                            <li>é›™åˆ†å€æ¶æ§‹ï¼šè¬›è§£ Launcher App (å‚™æ´) èˆ‡ User App (å·¥ä½œ) çš„é‚è¼¯ã€‚</li>
                            <li>Launcher Appï¼šå¯¦ä½œ Launcher é‚è¼¯ï¼Œæª¢æŸ¥ä¸¦å•Ÿå‹• OTA æœå‹™ã€‚</li>
                            <li>å¯¦ä½œï¼šä½¿ç”¨ PlatformIO é€²è¡Œ `espota` ç„¡ç·šæ›´æ–°æµç¨‹ã€‚</li>
                        </ul>
                    </div>
                    <button id="action-btn-C2_L9" class="action-btn bg-gray-400 text-white" disabled>
                        è¼‰å…¥ä¸­...
                    </button>
                </div>
            </div>

            <div class="lesson-card" 
                 id="lesson-C2_L10" 
                 data-course-id="C2_L10" 
                 data-course-name="å°ˆæ¡ˆæ•´åˆã€é™¤éŒ¯èˆ‡å„ªåŒ–" 
                 data-course-price="1290"
                 data-classroom-url="https://classroom.google.com/c/xxx...&lesson=L10">
                <div class="lesson-header">
                    <h2>ç¬¬ 10 èª²ï¼šå°ˆæ¡ˆæ•´åˆã€é™¤éŒ¯èˆ‡å„ªåŒ– <span class="duration">(3H)</span></h2>
                </div>
                <div class="lesson-body">
                    <div class="lesson-icon" title="Integrate Icon">ğŸŒŸ</div>
                    <span class="phase-tag">V. éŸŒé«”æ¶æ§‹èˆ‡ç¶­è­·</span>
                    <div class="core-content">
                        <strong>æ ¸å¿ƒå…§å®¹ï¼š</strong>
                        <ul>
                            <li>é›™æ¨¡å¼æŒ‡ä»¤ï¼šæ•´åˆ BLE èˆ‡ Wi-Fi æ¥æ”¶é‚è¼¯ï¼Œç¢ºä¿æŒ‡ä»¤éƒ½èƒ½å‘¼å« PID æ§åˆ¶ã€‚</li>
                            <li>éŒ¯èª¤è™•ç†ï¼šå¢åŠ é€šè¨Šä¸­æ–·ã€é¦¬é”æ•…éšœç­‰éŒ¯èª¤è¨Šæ¯çš„è™•ç†æ©Ÿåˆ¶ã€‚</li>
                            <li>å°ˆæ¡ˆå„ªåŒ–ï¼šèª¿æ•´ PID åƒæ•¸ã€å„ªåŒ–ç¨‹å¼ç¢¼æ•ˆç‡ï¼Œä¸¦é€²è¡Œæœ€çµ‚æ¸¬è©¦èˆ‡å±•ç¤ºã€‚</li>
                        </ul>
                    </div>
                    <button id="action-btn-C2_L10" class="action-btn bg-gray-400 text-white" disabled>
                        è¼‰å…¥ä¸­...
                    </button>
                </div>
            </div>

        </div>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyCO6Y6Pa7b7zbieJIErysaNF6-UqbT8KJw",
          authDomain: "e-learning-942f7.firebaseapp.com",
          projectId: "e-learning-942f7",
          storageBucket: "e-learning-942f7.firebasestorage.app",
          messagingSenderId: "878397058574",
          appId: "1:878397058574:web:28aaa07a291ee3baab165f"
        };
      
        // Initialize Firebase
        //const app = initializeApp(firebaseConfig);        
    </script>

    <script type="module">
        // 1. åŒ¯å…¥å¿…è¦çš„ Firebase å‡½å¼ (ä½¿ç”¨æ‚¨æŒ‡å®šçš„ 12.6.0 ç‰ˆæœ¬)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js"; 
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
        import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-functions.js";

/*
        // 2. æ‚¨çš„ Firebase é…ç½® (è«‹æ›¿æ›ç‚ºæ‚¨çš„çœŸå¯¦é…ç½®)
        const firebaseConfig = {
            apiKey: "AIzaSyBv2fciGdUD4CifE1fH3hnzzamPdrvjjN8",
            authDomain: "onlinelearning-b5cfc.firebaseapp.com",
            projectId: "onlinelearning-b5cfc",
            storageBucket: "onlinelearning-b5cfc.firebasestorage.app",
            messagingSenderId: "505254683984",
            appId: "1:505254683984:web:9653dfa4eef54899cedf855",
            measurementId: "G-P5LQ23Y31Q"
        };
*/
        // 3. åˆå§‹åŒ– Firebase æœå‹™
        const app = initializeApp(firebaseConfig);        
        const auth = getAuth(app);           
        const functions = getFunctions(app, 'asia-east1'); 
        
        const checkAuthFunction = httpsCallable(functions, 'checkPaymentAuthorization');

        // â— ä¿®æ­£é» 1: è³¼ç‰©è»Šè·¯å¾‘å®šç¾© (åŒä¸€å±¤ç›®éŒ„)
        const CART_URL = 'cart.html'; 
        // æˆæ¬Šä¸­è½‰é é¢è·¯å¾‘ (åŒä¸€å±¤ç›®éŒ„)
        const AUTH_URL = 'auth.html'; 

        // ===============================================
        // A. è³¼ç‰©è»Šæ ¸å¿ƒé‚è¼¯
        // ===============================================
        function addToCart(productId, productName, productPrice) {
            let cart = JSON.parse(localStorage.getItem('vibeCodingCart') || '{}');
            const priceNum = parseInt(productPrice, 10);
            
            if (!cart[productId]) {
                cart[productId] = { 
                    name: productName, 
                    price: priceNum, 
                    quantity: 1 
                };
                localStorage.setItem('vibeCodingCart', JSON.stringify(cart));
                alert(`ã€Œ${productName}ã€å·²åŠ å…¥è³¼ç‰©è»Šï¼`);
            } else {
                 alert(`ã€Œ${productName}ã€å·²åœ¨è³¼ç‰©è»Šä¸­ï¼`);
            }
            // ä¿®æ­£ï¼šå°å‘åŒä¸€å±¤ç›®éŒ„çš„ cart.html
            window.location.href = CART_URL; 
        }

        // ===============================================
        // B. ç™»å…¥/ç™»å‡ºé‚è¼¯
        // ===============================================
        async function handleLogin() {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                console.error("ç™»å…¥å¤±æ•—:", error);
            }
        }

        async function handleLogout() {
            await signOut(auth);
        }


        // ===============================================
        // C. å‹•æ…‹æŒ‰éˆ•ç‹€æ…‹æ›´æ–°æ ¸å¿ƒé‚è¼¯
        // ===============================================
        
        // å–å¾—æ‰€æœ‰èª²ç¨‹å¡ç‰‡
        const lessonCards = document.querySelectorAll('.lesson-card');

        /**
         * æ ¹æ“šæˆæ¬Šç‹€æ…‹æ›´æ–°å–®ä¸€èª²ç¨‹å¡ç‰‡çš„æŒ‰éˆ•
         */
        function updateCardAction(cardElement, status) {
            const btn = cardElement.querySelector('.action-btn');
            const courseId = cardElement.dataset.courseId;
            const courseName = cardElement.dataset.courseName;
            const coursePrice = cardElement.dataset.coursePrice;
            const classroomUrl = cardElement.dataset.classroomUrl;

            // æ¸…é™¤æ‰€æœ‰èˆŠçš„äº‹ä»¶ç›£è½å™¨
            btn.onclick = null; 
            btn.disabled = false;

            if (status === 'AUTHORIZED') {
                // ç‹€æ…‹ 1: å·²æˆæ¬Š (å·²ä»˜è²») -> é€²å…¥èª²ç¨‹
                btn.textContent = 'âœ… é€²å…¥èª²ç¨‹å…§å®¹';
                btn.className = 'action-btn bg-green-600 hover:bg-green-700 text-white';
                btn.onclick = () => {
                    // â— ä¿®æ­£é» 2: å°å‘åŒä¸€å±¤ç›®éŒ„çš„ auth.html é€²è¡ŒäºŒæ¬¡é©—è­‰
                    window.location.href = `${AUTH_URL}?url=${encodeURIComponent(classroomUrl)}`;
                };
            } else if (status === 'UNAUTHORIZED' || status === 'NOT_LOGGED_IN') {
                // ç‹€æ…‹ 2 & 3: æœªæˆæ¬Šæˆ–æœªç™»å…¥ -> åŠ å…¥è³¼ç‰©è»Š
                btn.textContent = 'ğŸ›’ åŠ å…¥è³¼ç‰©è»Š (NT$ ' + coursePrice + ')';
                btn.className = 'action-btn bg-indigo-600 hover:bg-indigo-700 text-white';
                btn.onclick = () => {
                    addToCart(courseId, courseName, coursePrice); 
                };
            } else if (status === 'LOADING') {
                // ç‹€æ…‹ 4: è¼‰å…¥ä¸­
                btn.textContent = 'æ¬Šé™æª¢æŸ¥ä¸­...';
                btn.className = 'action-btn bg-gray-400 text-white';
                btn.disabled = true;
            } else if (status === 'ERROR') {
                // éŒ¯èª¤ç‹€æ…‹
                btn.textContent = 'éŒ¯èª¤: é»æ“Šé‡æ–°è¼‰å…¥';
                btn.className = 'action-btn bg-red-600 hover:bg-red-700 text-white';
                btn.onclick = () => window.location.reload();
            }
        }

        /**
         * æª¢æŸ¥å–®ä¸€èª²ç¨‹çš„æˆæ¬Šç‹€æ…‹
         */
        async function checkLessonAuthorization(cardElement, user) {
            updateCardAction(cardElement, 'LOADING');

            const courseId = cardElement.dataset.courseId;
            const classroomUrl = cardElement.dataset.classroomUrl;

            try {
                // å‘¼å« Cloud Function æª¢æŸ¥æˆæ¬Š
                const result = await checkAuthFunction({ 
                    courseId: courseId, 
                    targetUrl: encodeURIComponent(classroomUrl) 
                });

                const status = result.data.status; 
                
                // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
                updateCardAction(cardElement, status);

            } catch (error) {
                console.error(`èª²ç¨‹ ${courseId} æˆæ¬Šæª¢æŸ¥å¤±æ•—:`, error);
                // æª¢æŸ¥å¤±æ•—ï¼Œé è¨­å°å‘è³¼ç‰©è»Šï¼ˆæœªæˆæ¬Šç‹€æ…‹ï¼‰
                updateCardAction(cardElement, 'UNAUTHORIZED');
            }
        }

        // ----------------------------------------------------
        // D. ç¸½é«”æˆæ¬Šæµç¨‹æ§åˆ¶å™¨
        // ----------------------------------------------------
        onAuthStateChanged(auth, (user) => {
            const userDisplay = document.getElementById('user-display');
            const loginBtn = document.getElementById('login-btn');

            if (user) {
                // 1. å·²ç™»å…¥ï¼šæ›´æ–° UIï¼Œä¸¦æª¢æŸ¥æ‰€æœ‰èª²ç¨‹çš„æˆæ¬Šç‹€æ…‹
                userDisplay.textContent = `æ‚¨å¥½, ${user.displayName || user.email}`;
                loginBtn.textContent = 'ç™»å‡º';
                loginBtn.onclick = handleLogout;
                
                lessonCards.forEach(card => {
                    checkLessonAuthorization(card, user);
                });
            } else {
                // 2. æœªç™»å…¥ï¼šæ›´æ–° UIï¼Œå°‡æ‰€æœ‰èª²ç¨‹æŒ‰éˆ•è¨­å®šç‚ºã€ŒåŠ å…¥è³¼ç‰©è»Šã€
                userDisplay.textContent = 'è¨ªå®¢æ¨¡å¼';
                loginBtn.textContent = 'ç™»å…¥';
                loginBtn.onclick = handleLogin;
                
                lessonCards.forEach(card => {
                    updateCardAction(card, 'NOT_LOGGED_IN');
                });
            }
        });

    </script>
</body>
</html>