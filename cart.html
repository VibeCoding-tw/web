<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‹•æ…‹è³¼ç‰©è»Šï¼šèª²ç¨‹é¸è³¼</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f9; color: #333; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { max-width: 1200px; display: flex; gap: 30px; }
        h1 { color: #007bff; text-align: center; margin-bottom: 30px; width: 100%; }
        
        /* èª²ç¨‹æ¸…å–®å€å¡Š */
        .course-list { flex: 3; background-color: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); }
        .course-card { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; }
        .course-card:last-child { border-bottom: none; }
        .course-info h3 { margin: 0 0 5px 0; color: #333; font-size: 1.1em; }
        .course-info p { margin: 0; color: #dc3545; font-weight: bold; }

        /* è³¼ç‰©è»Šå€å¡Š */
        .shopping-cart { 
            flex: 1; 
            background-color: #f0f8ff; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            height: fit-content; /* ç¢ºä¿é«˜åº¦ä¸æœƒä½”æ»¿è¦–çª— */
            position: sticky;
            top: 20px;
        }
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px dashed #ddd; }
        .cart-item:last-of-type { border-bottom: none; }
        .cart-total { font-size: 1.2em; font-weight: bold; margin-top: 20px; padding-top: 15px; border-top: 2px solid #007bff; }
        .add-btn, .remove-btn, .checkout-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 0.9em;
        }
        .add-btn { background-color: #28a745; color: white; }
        .add-btn:hover { background-color: #218838; }
        .remove-btn { background-color: #ffc107; color: #333; margin-left: 10px; }
        .remove-btn:hover { background-color: #e0a800; }
        .checkout-btn {
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            font-size: 1.1em;
            margin-top: 20px;
        }
        .checkout-btn:hover { background-color: #0056b3; }
        .empty-cart-message { color: #6c757d; font-style: italic; text-align: center; padding: 30px 0;}
    </style>
</head>
<body>
    <div class="container">
        <div class="course-list">
            <h1>èª²ç¨‹åˆ—è¡¨</h1>
            <div id="course-cards">
                </div>
        </div>

        <div class="shopping-cart">
            <h2>ğŸ›’ æ‚¨çš„è¨‚å–®</h2>
            <div id="cart-items-container">
                <p class="empty-cart-message">è³¼ç‰©è»Šæ˜¯ç©ºçš„</p>
            </div>
            
            <div id="cart-summary" style="display: none;">
                <div class="cart-total">
                    ç¸½è¨ˆï¼š<span id="cart-total-price">0</span> TWD
                </div>
                <button class="checkout-btn" onclick="checkout()">å‰å¾€çµå¸³</button>
            </div>
        </div>
    </div>

    <script>
        // èª²ç¨‹è³‡æ–™çµæ§‹
        const COURSES = {
            'C1': { id: 'C1', name: 'å…¥é–€èª²ç¨‹ï¼šWeb App é™æ§å™¨è¨­è¨ˆ', price: 2800, url: 'https://classroom.google.com/c/C1?cjc=A1' },
            'C2': { id: 'C2', name: 'é€²éšèª²ç¨‹ï¼šå½±åƒè™•ç†èˆ‡ AI æ‡‰ç”¨', price: 3500, url: 'https://classroom.google.com/c/C2?cjc=B2' },
            'C3': { id: 'C3', name: 'é–‹ç™¼ç’°å¢ƒå®‰è£èˆ‡è¨­å®š (å·¥å…·èª²)', price: 500, url: 'https://classroom.google.com/c/C3?cjc=T3' }
        };

        // è³¼ç‰©è»Šç‹€æ…‹ (å„²å­˜ {id: 'C1', quantity: 1} çµæ§‹)
        let cart = [];

        /**
         * è®€å–æœ¬åœ°å„²å­˜çš„è³¼ç‰©è»Šæ•¸æ“š
         */
        function loadCart() {
            const storedCart = localStorage.getItem('shoppingCart');
            if (storedCart) {
                cart = JSON.parse(storedCart);
            }
        }

        /**
         * å°‡è³¼ç‰©è»Šæ•¸æ“šå„²å­˜åˆ°æœ¬åœ°
         */
        function saveCart() {
            localStorage.setItem('shoppingCart', JSON.stringify(cart));
        }

        /**
         * å°‡é …ç›®åŠ å…¥è³¼ç‰©è»Š
         * @param {string} courseId - èª²ç¨‹ ID
         */
        function addItem(courseId) {
            const existingItem = cart.find(item => item.id === courseId);
            
            if (existingItem) {
                existingItem.quantity += 1; // å‡è¨­èª²ç¨‹å¯ä»¥è²·å¤šä»½ï¼Œä½†é€šå¸¸æ˜¯ 1
            } else {
                cart.push({ id: courseId, quantity: 1 });
            }
            saveCart();
            renderCart();
        }

        /**
         * å¾è³¼ç‰©è»Šç§»é™¤é …ç›®
         * @param {string} courseId - èª²ç¨‹ ID
         */
        function removeItem(courseId) {
            const index = cart.findIndex(item => item.id === courseId);
            if (index > -1) {
                cart.splice(index, 1); // ç›´æ¥ç§»é™¤é …ç›®
                saveCart();
                renderCart();
            }
        }

        /**
         * è¨ˆç®—ç¸½åƒ¹
         */
        function calculateTotal() {
            return cart.reduce((total, item) => {
                const course = COURSES[item.id];
                return total + (course.price * item.quantity);
            }, 0);
        }

        /**
         * ç¹ªè£½èª²ç¨‹å¡ç‰‡æ¸…å–®
         */
        function renderCourseList() {
            const container = document.getElementById('course-cards');
            container.innerHTML = '';
            
            Object.values(COURSES).forEach(course => {
                const card = document.createElement('div');
                card.className = 'course-card';
                card.innerHTML = `
                    <div class="course-info">
                        <h3>${course.name}</h3>
                        <p>NT$ ${course.price.toLocaleString()}</p>
                    </div>
                    <button class="add-btn" onclick="addItem('${course.id}')">åŠ å…¥è³¼ç‰©è»Š</button>
                `;
                container.appendChild(card);
            });
        }

        /**
         * ç¹ªè£½è³¼ç‰©è»Šå…§å®¹
         */
        function renderCart() {
            const itemsContainer = document.getElementById('cart-items-container');
            const summary = document.getElementById('cart-summary');
            const emptyMessage = itemsContainer.querySelector('.empty-cart-message');
            
            itemsContainer.innerHTML = '';
            let hasItems = false;
            
            cart.forEach(item => {
                const course = COURSES[item.id];
                if (course) {
                    hasItems = true;
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'cart-item';
                    itemDiv.innerHTML = `
                        <span>${course.name} x ${item.quantity}</span>
                        <div>
                            <span>NT$ ${(course.price * item.quantity).toLocaleString()}</span>
                            <button class="remove-btn" onclick="removeItem('${item.id}')">ç§»é™¤</button>
                        </div>
                    `;
                    itemsContainer.appendChild(itemDiv);
                }
            });

            // é¡¯ç¤ºæˆ–éš±è—è³¼ç‰©è»Šç‹€æ…‹å’Œç¸½çµ
            if (hasItems) {
                if(emptyMessage) emptyMessage.style.display = 'none';
                summary.style.display = 'block';
                document.getElementById('cart-total-price').textContent = calculateTotal().toLocaleString();
            } else {
                if(!emptyMessage) itemsContainer.innerHTML = '<p class="empty-cart-message">è³¼ç‰©è»Šæ˜¯ç©ºçš„</p>';
                summary.style.display = 'none';
            }
        }

        /**
         * çµå¸³é‚è¼¯ï¼šæ¨¡æ“¬ä»˜è²»å’Œé©—è­‰
         */
        function checkout() {
            if (cart.length === 0) {
                alert("è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼Œè«‹å…ˆåŠ å…¥èª²ç¨‹ã€‚");
                return;
            }

            // 1. åŸ·è¡Œçµå¸³æµç¨‹ (æ¨¡æ“¬ï¼šå¯¦éš›æ‡‰å°å‘é‡‘æµç³»çµ±)
            alert(`æ­£åœ¨è™•ç† NT$ ${calculateTotal().toLocaleString()} çš„è¨‚å–®...`);

            // 2. å‡è¨­ä½¿ç”¨è€…å·²å®Œæˆä»˜è²»ï¼Œæ‚¨ç¾åœ¨éœ€è¦åœ¨å¾Œç«¯è¨˜éŒ„æ­¤ç”¨æˆ¶çš„ä»˜è²»ç‹€æ…‹ã€‚
            //    åœ¨ç´”å‰ç«¯ç’°å¢ƒä¸­ï¼Œæˆ‘å€‘åªèƒ½æ¨¡æ“¬é€™å€‹ç‹€æ…‹ã€‚

            const isPaymentSuccessful = confirm("æ¨¡æ“¬ï¼šä»˜è²»æˆåŠŸäº†å—ï¼Ÿ (æŒ‰ç¢ºå®šå°å‘èª²ç¨‹ï¼ŒæŒ‰å–æ¶ˆå°å‘è³¼ç‰©è»Š)");
            
            if (isPaymentSuccessful) {
                // æ¨¡æ“¬ä»˜è²»æˆåŠŸï¼Œä¸¦æ¸…é™¤è³¼ç‰©è»Š
                localStorage.removeItem('shoppingCart');
                alert("ä»˜è²»æˆåŠŸï¼æ­£åœ¨ç‚ºæ‚¨é©—è­‰èª²ç¨‹æ¬Šé™ã€‚");

                // 3. å°å‘åˆ° auth.html é€²è¡Œæ¬Šé™é©—è­‰ï¼Œä¸¦æŒ‡å®šä¸€å€‹å·²ä»˜è²»çš„èª²ç¨‹ URL ä½œç‚ºç¯„ä¾‹
                const firstPaidCourseId = cart[0].id;
                const targetUrl = COURSES[firstPaidCourseId].url;

                // å¿…é ˆ URL ç·¨ç¢¼ç›®æ¨™ URL
                const encodedUrl = encodeURIComponent(targetUrl);

                // 4. auth.html åœ¨ä¸Šä¸€å±¤ç›®éŒ„ï¼Œå› æ­¤è·¯å¾‘ç‚º ../auth.html
                window.location.href = `../auth.html?url=${encodedUrl}&user_status=paid`; 
            } else {
                // ä»˜è²»å¤±æ•—æˆ–å–æ¶ˆï¼Œä¿æŒåœ¨è³¼ç‰©è»Šé é¢ï¼Œæˆ–å°å‘è¨‚å–®æŸ¥è©¢é 
                alert("ä»˜è²»æœªå®Œæˆï¼Œè«‹é‡æ–°å˜—è©¦ã€‚");
            }
        }

        // åˆå§‹åŒ–
        loadCart();
        renderCourseList();
        renderCart();
    </script>
</body>
</html>